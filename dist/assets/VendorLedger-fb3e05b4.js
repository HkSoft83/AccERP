import{V as O,r as n,j as e,B as w}from"./index-4ee0f0da.js";import{C as R,a as L,b as M,c as z}from"./card-0b571230.js";import{S as J,a as H,b as A,c as U,d as Y}from"./select-5d8a578c.js";import{D as T,f as $}from"./date-picker-2abee23a.js";import{I as X}from"./input-8ed76811.js";import{T as q,a as G,b as j,c as m,d as K,e as c}from"./table-655433fa.js";import{U as Q}from"./user-bee0cc55.js";import{P as W}from"./printer-32ae61b2.js";import{S as Z}from"./search-8c5c897c.js";import{p,F as _}from"./parseISO-76afde5b.js";import"./check-6bd3e78d.js";const me=()=>{const[F]=O(),h=F.get("vendorId"),[b,C]=n.useState([]),[o,N]=n.useState(h||""),[k,I]=n.useState([]),[i,V]=n.useState([]),[x,S]=n.useState(null),[f,D]=n.useState(null),[g,y]=n.useState("");n.useEffect(()=>{const r=(JSON.parse(localStorage.getItem("vendors"))||[{id:"vend-001",name:"Supplier Alpha Inc.",openingBalance:5e3,openingBalanceDate:"2025-01-01"},{id:"vend-002",name:"Vendor Beta Corp.",openingBalance:0,openingBalanceDate:"2025-01-01"}]).map(s=>({id:s.vendorNumber||s.id,name:s.name,openingBalance:parseFloat(s.openingBalance)||0,openingBalanceDate:s.openingBalanceDate?p(s.openingBalanceDate):new Date(new Date().getFullYear(),0,1)}));C(r),!h&&r.length>0&&N(r[0].id)},[h]),n.useEffect(()=>{if(!o)return;const a=JSON.parse(localStorage.getItem("purchaseBills"))||[],r=JSON.parse(localStorage.getItem("payments"))||[],s=JSON.parse(localStorage.getItem("purchaseReturns"))||[],B=JSON.parse(localStorage.getItem("debitNotes"))||[],l=[];a.filter(t=>t.vendorId===o).forEach(t=>{var u;return l.push({date:p(t.billDate),type:"Purchase Bill",ref:t.billNumber,narration:`Bill for ${((u=t.lineItems)==null?void 0:u.length)||0} items`,debit:0,credit:parseFloat(t.grandTotal)||0})}),r.filter(t=>t.paidTo===o).forEach(t=>l.push({date:p(t.date),type:"Payment",ref:t.paymentNumber,narration:t.narration||"Payment made",debit:parseFloat(t.amount)||0,credit:0})),s.filter(t=>t.vendorId===o).forEach(t=>{var u;return l.push({date:p(t.returnDate),type:"Purchase Return",ref:t.returnNumber,narration:`Return of ${((u=t.lineItems)==null?void 0:u.length)||0} items`,debit:parseFloat(t.grandTotal)||0,credit:0})}),B.filter(t=>t.creditAccount===o).forEach(t=>l.push({date:p(t.date),type:"Debit Note",ref:t.debitNoteNumber,narration:t.narration||"Debit issued",debit:parseFloat(t.amount)||0,credit:0})),I(l)},[o]);const d=n.useMemo(()=>b.find(a=>a.id===o),[b,o]),v=n.useMemo(()=>{if(!d)return[];let a=d.openingBalance;const r=d.openingBalanceDate||new Date(new Date().getFullYear(),0,1),s=[];return s.push({date:r,type:"Opening Balance",ref:"-",narration:"Opening Balance",debit:d.openingBalance<0?Math.abs(d.openingBalance):0,credit:d.openingBalance>=0?d.openingBalance:0,balance:a}),[...k].sort((l,t)=>l.date-t.date).forEach(l=>{a+=(l.credit||0)-(l.debit||0),s.push({...l,balance:a})}),s},[k,d]);n.useEffect(()=>{let a=v;if(x&&(a=a.filter(r=>r.date>=x)),f&&(a=a.filter(r=>r.date<=f)),g){const r=g.toLowerCase();a=a.filter(s=>s.type.toLowerCase().includes(r)||s.ref.toLowerCase().includes(r)||s.narration.toLowerCase().includes(r))}V(a)},[v,x,f,g]);const E=()=>window.print(),P=()=>{S(null),D(null),y("")};return e.jsx("div",{className:"space-y-6 p-4 md:p-6",children:e.jsxs(R,{className:"shadow-xl border-border dark:border-dark-border",children:[e.jsx(L,{className:"bg-muted/50 dark:bg-dark-muted/50 p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs(M,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(Q,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Vendor Ledger"]}),e.jsxs(w,{onClick:E,variant:"outline",size:"sm",className:"self-start sm:self-center",children:[e.jsx(W,{size:16,className:"mr-2"})," Print"]})]})}),e.jsxs(z,{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[h?null:e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"vendorSelect",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"Select Vendor"}),e.jsxs(J,{value:o,onValueChange:N,children:[e.jsx(H,{id:"vendorSelect",children:e.jsx(A,{placeholder:"Choose a vendor"})}),e.jsx(U,{children:b.map(a=>e.jsxs(Y,{value:a.id,children:[a.name," (",a.id,")"]},a.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"startDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"From Date"}),e.jsx(T,{date:x,setDate:S,id:"startDate",placeholder:"Start Date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"endDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"To Date"}),e.jsx(T,{date:f,setDate:D,id:"endDate",placeholder:"End Date"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center pt-2",children:[e.jsxs("div",{className:"relative flex-grow w-full sm:w-auto",children:[e.jsx(Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground dark:text-dark-muted-foreground"}),e.jsx(X,{type:"search",placeholder:"Search transactions...",value:g,onChange:a=>y(a.target.value),className:"pl-8 w-full"})]}),e.jsxs(w,{onClick:P,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[e.jsx(_,{size:16,className:"mr-2"})," Clear Filters"]})]}),d&&e.jsxs("div",{className:"p-3 bg-primary/5 dark:bg-dark-primary/10 rounded-md border border-primary/20 dark:border-dark-primary/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:d.name}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Vendor ID: ",d.id]})]}),e.jsx("div",{className:"overflow-x-auto border border-border dark:border-dark-border rounded-lg",children:e.jsxs(q,{children:[e.jsx(G,{className:"bg-muted dark:bg-dark-muted",children:e.jsxs(j,{children:[e.jsx(m,{className:"w-[100px]",children:"Date"}),e.jsx(m,{children:"Type / Ref#"}),e.jsx(m,{children:"Narration"}),e.jsx(m,{className:"text-right",children:"Debit"}),e.jsx(m,{className:"text-right",children:"Credit"}),e.jsx(m,{className:"text-right",children:"Balance"})]})}),e.jsx(K,{children:i.length>0?i.map((a,r)=>e.jsxs(j,{className:"hover:bg-muted/50 dark:hover:bg-dark-muted/50",children:[e.jsx(c,{children:$(a.date,"dd-MMM-yy")}),e.jsxs(c,{children:[e.jsx("div",{className:"font-medium",children:a.type}),e.jsx("div",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground",children:a.ref})]}),e.jsx(c,{children:a.narration}),e.jsx(c,{className:"text-right",children:(a.debit||0)>0?(a.debit||0).toFixed(2):"-"}),e.jsx(c,{className:"text-right",children:(a.credit||0)>0?(a.credit||0).toFixed(2):"-"}),e.jsx(c,{className:"text-right font-semibold",children:a.balance.toFixed(2)})]},r)):e.jsx(j,{children:e.jsx(c,{colSpan:6,className:"text-center h-24 text-muted-foreground dark:text-dark-muted-foreground",children:"No transactions found for this vendor."})})})]})}),i.length>0&&e.jsxs("div",{className:"flex justify-end pt-2 text-sm font-semibold text-primary dark:text-dark-primary",children:["Final Balance: ",i[i.length-1].balance.toFixed(2),i[i.length-1].balance>=0?" (Payable)":" (Receivable)"]})]})]})})};export{me as default};
