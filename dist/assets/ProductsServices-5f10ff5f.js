import{c as Be,u as ke,r as d,j as e,B as j,A as Ve,m as he}from"./index-712dd123.js";import{I as m}from"./input-0e3bd006.js";import{D as Se,a as Ce,b as Fe,c as Qe,d as ze,e as Ee,f as Oe,g as We,h as ge,i as qe,j as $e,A as Le,k as He,l as Ke,m as Re,n as Je,o as Ge,p as Ye,q as Me}from"./alert-dialog-7872d5c2.js";import{L as i}from"./label-b1f93db9.js";import{S as Xe}from"./switch-4166d1eb.js";import{S as ye,a as be,b as ve,c as fe,d as je}from"./select-4030790a.js";import{P as ce}from"./plus-circle-b5794bb7.js";import{T as le}from"./trash-2-2438c5fa.js";import{S as Ze}from"./save-f7d3c425.js";import{C as _e,a as et,b as tt,c as rt}from"./card-f81b6c80.js";import{F as at}from"./file-down-fd048a3f.js";import{S as st}from"./search-66d65b07.js";import{P as ot,A as dt}from"./pen-square-12844aac.js";import"./check-c977fa3e.js";const me=Be("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),nt=[{value:"Stock",label:"Stock",description:"Products you buy and/or sell and that you track quantities of."},{value:"Non-stock",label:"Non-stock",description:"Products you buy and/or sell but don’t need to (or can’t) track quantities of, for example, nuts and bolts used in an installation."},{value:"Service",label:"Service",description:"Services that you provide to customers."},{value:"Combo",label:"Combo",description:"A collection of products and/or services that you sell together, for example, a gift basket of fruit, cheese, and wine."}],it=({onSave:u,onCancel:h,initialData:a,isEditMode:n,allProducts:b})=>{const{toast:s}=ke(),[o,C]=d.useState("Stock"),[S,F]=d.useState(""),[V,Q]=d.useState(""),[w,N]=d.useState(""),[U,I]=d.useState(""),[T,z]=d.useState(""),[E,O]=d.useState(""),[B,W]=d.useState("Extra Field 1"),[q,f]=d.useState(""),[P,r]=d.useState("Extra Field 2"),[x,g]=d.useState(""),[c,p]=d.useState(""),[D,$]=d.useState(""),[ue,M]=d.useState(""),[xe,X]=d.useState(""),[L,Z]=d.useState(!1),[K,_]=d.useState(""),[R,J]=d.useState([]),[ee,te]=d.useState(""),[re,ae]=d.useState(1),[y,H]=d.useState([{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),[G,se]=d.useState(""),[oe,de]=d.useState(1),[ne,pe]=d.useState(null);d.useEffect(()=>{var t,l,k,v;n&&a?(C(a.productType||"Stock"),F(a.name||""),Q(a.code||a.id||""),N(a.description||""),I(a.batchNo||""),z(a.manufacturingDate||""),O(a.expiryDate||""),W(a.extraField1Name||"Extra Field 1"),f(a.extraField1Value||""),r(a.extraField2Name||"Extra Field 2"),g(a.extraField2Value||""),p(a.category||""),$(((t=a.costingPrice)==null?void 0:t.toString())||""),M(((l=a.salesPrice)==null?void 0:l.toString())||""),X(((k=a.openingQuantity)==null?void 0:k.toString())||""),Z(a.hasWarranty||!1),_(((v=a.warrantyDays)==null?void 0:v.toString())||""),H(a.units&&a.units.length>0?a.units:[{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),pe(a.id||a.code),J(a.comboItems||[])):we()},[a,n]);const we=()=>{C("Stock"),F(""),Q(""),N(""),I(""),z(""),O(""),W("Extra Field 1"),f(""),r("Extra Field 2"),g(""),p(""),$(""),M(""),X(""),Z(!1),_(""),H([{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),se(""),de(1),pe(null),J([]),te(""),ae(1)},Pe=()=>{if(!G.trim()||oe<=0){s({title:"Invalid Unit",description:"Please provide a valid unit name and factor.",variant:"destructive"});return}if(y.find(t=>t.name.toLowerCase()===G.trim().toLowerCase())){s({title:"Duplicate Unit",description:"This unit name already exists.",variant:"destructive"});return}H([...y,{id:Date.now(),name:G.trim(),factor:parseFloat(oe),isBase:y.length===0}]),se(""),de(1)},De=t=>{if(y.length===1){s({title:"Cannot Remove",description:"At least one unit must be defined.",variant:"destructive"});return}const l=y.find(k=>k.id===t);if(l&&l.isBase&&y.length>1){s({title:"Cannot Remove Base Unit",description:"Please set another unit as base before removing.",variant:"destructive"});return}H(y.filter(k=>k.id!==t))},Ae=t=>{H(y.map(l=>({...l,isBase:l.id===t})))},ie=()=>{const t=y.find(l=>l.isBase);return t?t.name:"N/A"},Ue=()=>{if(!ee){s({title:"Validation Error",description:"Please select a product/service to add to the combo.",variant:"destructive"});return}if(re<=0){s({title:"Validation Error",description:"Quantity must be a positive number.",variant:"destructive"});return}const t=b.find(l=>l.id===ee);t&&(J(l=>[...l,{...t,comboQuantity:re}]),te(""),ae(1))},Ie=t=>{J(l=>l.filter(k=>k.id!==t))},Te=t=>{if(t.preventDefault(),!S.trim()){s({title:"Validation Error",description:"Product name is required.",variant:"destructive"});return}if(o!=="Service"&&o!=="Combo"&&y.filter(v=>v.isBase).length!==1){s({title:"Validation Error",description:"Exactly one unit must be set as the base unit.",variant:"destructive"});return}if(L&&(!K||parseInt(K)<=0)){s({title:"Validation Error",description:"Warranty days must be a positive number.",variant:"destructive"});return}if(o==="Combo"&&R.length===0){s({title:"Validation Error",description:"Combo products must contain at least one item.",variant:"destructive"});return}const l=y.find(v=>v.isBase),k={id:ne||`prod-${Date.now()}`,productType:o,name:S,code:V||(ne?ne.split("-")[1]||String(Date.now()).slice(-4):`P${String(Date.now()).slice(-4)}`),description:w,batchNo:o!=="Combo"?U:"",manufacturingDate:o!=="Combo"?T:"",expiryDate:o!=="Combo"?E:"",extraField1Name:o!=="Combo"?B:"",extraField1Value:o!=="Combo"?q:"",extraField2Name:o!=="Combo"?P:"",extraField2Value:o!=="Combo"?x:"",batchNo:U,manufacturingDate:T,expiryDate:E,extraField1Name:B,extraField1Value:q,extraField2Name:P,extraField2Value:x,category:o==="Combo"?"Combo":c,costingPrice:o==="Combo"?0:parseFloat(D)||0,salesPrice:o==="Combo"?0:parseFloat(ue)||0,openingQuantity:o==="Service"||o==="Combo"?1/0:parseFloat(xe)||0,hasWarranty:L,warrantyDays:L?parseInt(K):0,units:o==="Service"||o==="Combo"?[]:y.map(v=>({...v,factor:parseFloat(v.factor)})),baseUnitName:o==="Service"||o==="Combo"?"N/A":l?l.name:"N/A",comboItems:o==="Combo"?R.map(v=>({id:v.id,name:v.name,comboQuantity:v.comboQuantity})):[],sl:n&&a?a.sl:void 0,location:n&&a?a.location:"Warehouse A"};u(k,n),s({title:`Product ${n?"Updated":"Added"}`,description:`${S} has been successfully ${n?"updated":"added"}.`,className:"bg-green-500 text-white dark:bg-green-600 dark:text-white"}),h()};return e.jsxs("form",{onSubmit:Te,className:"space-y-6 p-1",children:[e.jsxs(Se,{className:"hidden",children:[e.jsx(Ce,{children:n?"Edit Product/Service":"Add New Product/Service"}),e.jsx(Fe,{children:n?"Update the details of the existing product or service.":"Fill in the details to add a new product or service to your inventory."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"productType",className:"font-semibold",children:["Product/Service Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(ye,{onValueChange:C,value:o,disabled:n,children:[e.jsx(be,{id:"productType",children:e.jsx(ve,{placeholder:"Select a product type"})}),e.jsx(fe,{children:nt.map(t=>e.jsxs(je,{value:t.value,children:[e.jsx("span",{className:"font-medium",children:t.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"productName",className:"font-semibold",children:["Product/Service Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(m,{id:"productName",value:S,onChange:t=>F(t.target.value),placeholder:"e.g., Premium Widget, Hourly Consulting",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"productCode",className:"font-semibold",children:"Product Code/SKU"}),e.jsx(m,{id:"productCode",value:V,onChange:t=>Q(t.target.value),placeholder:"Auto-generated if blank",disabled:n}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Product code cannot be changed after creation."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",className:"font-semibold",children:"Description"}),e.jsx(m,{id:"description",value:w,onChange:t=>N(t.target.value),placeholder:"Brief description of the product/service"})]}),o!=="Combo"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"batchNo",className:"font-semibold",children:"Batch No"}),e.jsx(m,{id:"batchNo",value:U,onChange:t=>I(t.target.value),placeholder:"e.g., BATCH-2023-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"manufacturingDate",className:"font-semibold",children:"Manufacturing Date"}),e.jsx(m,{id:"manufacturingDate",type:"date",value:T,onChange:t=>z(t.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"expiryDate",className:"font-semibold",children:"Expiry Date"}),e.jsx(m,{id:"expiryDate",type:"date",value:E,onChange:t=>O(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"extraField1Name",className:"font-semibold",children:"Extra Field 1 Name"}),e.jsx(m,{id:"extraField1Name",value:B,onChange:t=>W(t.target.value),placeholder:"e.g., Color"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"extraField1Value",className:"font-semibold",children:B}),e.jsx(m,{id:"extraField1Value",value:q,onChange:t=>f(t.target.value),placeholder:"Value for Extra Field 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"extraField2Name",className:"font-semibold",children:"Extra Field 2 Name"}),e.jsx(m,{id:"extraField2Name",value:P,onChange:t=>r(t.target.value),placeholder:"e.g., Size"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"extraField2Value",className:"font-semibold",children:P}),e.jsx(m,{id:"extraField2Value",value:x,onChange:t=>setExtraField22Value(t.target.value),placeholder:"Value for Extra Field 2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"category",className:"font-semibold",children:"Category"}),e.jsx(m,{id:"category",value:c,onChange:t=>p(t.target.value),placeholder:"e.g., Electronics, Services, Materials"})]})]}),o!=="Combo"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"costingPrice",className:"font-semibold",children:["Costing Price (per ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(m,{id:"costingPrice",type:"number",value:D,onChange:t=>$(t.target.value),placeholder:"0.00",min:"0",step:"0.01",disabled:n,className:n?"disabled:opacity-70 disabled:cursor-not-allowed":""}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Costing price cannot be changed after creation."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(i,{htmlFor:"salesPrice",className:"font-semibold",children:["Default Sales Price (per ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(m,{id:"salesPrice",type:"number",value:ue,onChange:t=>M(t.target.value),placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx(Xe,{id:"hasWarranty",checked:L,onCheckedChange:Z}),e.jsx(i,{htmlFor:"hasWarranty",className:"font-semibold",children:"Has Warranty"})]}),L&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(i,{htmlFor:"warrantyDays",className:"font-semibold",children:"Warranty Days"}),e.jsx(m,{id:"warrantyDays",type:"number",value:K,onChange:t=>_(t.target.value),placeholder:"e.g., 365"})]}),o==="Stock"&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(i,{htmlFor:"openingQuantity",className:"font-semibold",children:["Opening Quantity (in ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(m,{id:"openingQuantity",type:"number",value:xe,onChange:t=>X(t.target.value),placeholder:"0",min:"0",disabled:n,className:n?"disabled:opacity-70 disabled:cursor-not-allowed":""}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening quantity cannot be changed after creation."})]}),(o==="Stock"||o==="Non-stock")&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border dark:border-dark-border mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:"Manage Units of Measure"}),e.jsxs("div",{className:"p-4 bg-muted/50 dark:bg-dark-muted/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"newUnitName",children:"New Unit Name"}),e.jsx(m,{id:"newUnitName",value:G,onChange:t=>se(t.target.value),placeholder:"e.g., Dozen, Box"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"newUnitFactor",children:"Factor (to Base Unit)"}),e.jsx(m,{id:"newUnitFactor",type:"number",value:oe,onChange:t=>de(t.target.value),placeholder:"e.g., 12",min:"0.001",step:"any"})]}),e.jsxs(j,{type:"button",onClick:Pe,className:"sm:self-end bg-secondary hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover text-secondary-foreground dark:text-dark-secondary-foreground",children:[e.jsx(ce,{size:18,className:"mr-2"})," Add Unit"]})]}),e.jsx(Ve,{children:y.length>0&&e.jsx(he.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2 pt-2",children:y.map(t=>e.jsxs(he.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{type:"spring",stiffness:300,damping:30},className:"flex items-center justify-between p-2.5 bg-background dark:bg-dark-background rounded-md shadow-sm border border-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Ae(t.id),className:`mr-2 h-7 w-7 ${t.isBase?"text-yellow-500 dark:text-yellow-400":"text-muted-foreground dark:text-dark-muted-foreground"}`,children:e.jsx(me,{size:18,fill:t.isBase?"currentColor":"none"})}),e.jsx("span",{className:"font-medium text-foreground dark:text-dark-foreground",children:t.name}),e.jsxs("span",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground ml-2",children:["(",t.factor," to Base)"]})]}),e.jsx(j,{type:"button",variant:"ghost",size:"icon",onClick:()=>De(t.id),className:"text-destructive dark:text-red-400 hover:text-destructive/80 h-7 w-7",children:e.jsx(le,{size:16})})]},t.id))})}),e.jsxs("p",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground pt-1",children:["Click the star ",e.jsx(me,{size:12,className:"inline text-yellow-500"})," to set a unit as the base unit. All other unit factors are relative to this base unit."]})]})]}),o==="Combo"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border dark:border-dark-border mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:"Combo Items"}),e.jsxs("div",{className:"p-4 bg-muted/50 dark:bg-dark-muted/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(i,{htmlFor:"comboProduct",children:"Select Product/Service"}),e.jsxs(ye,{onValueChange:te,value:ee,children:[e.jsx(be,{id:"comboProduct",children:e.jsx(ve,{placeholder:"Select a product/service"})}),e.jsx(fe,{children:b.filter(t=>t.productType!=="Combo").map(t=>e.jsxs(je,{value:t.id,children:[t.name," (",t.productType,")"]},t.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{htmlFor:"comboQuantity",children:"Quantity"}),e.jsx(m,{id:"comboQuantity",type:"number",value:re,onChange:t=>ae(parseInt(t.target.value)||1),min:"1"})]}),e.jsxs(j,{type:"button",onClick:Ue,className:"sm:self-end bg-secondary hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover text-secondary-foreground dark:text-dark-secondary-foreground",children:[e.jsx(ce,{size:18,className:"mr-2"})," Add Item"]})]}),R.length>0&&e.jsx("div",{className:"overflow-x-auto rounded-md border border-border dark:border-dark-border mt-4",children:e.jsxs("table",{className:"w-full text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2",children:"Product/Service Name"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-right",children:"Quantity"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:R.map(t=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0",children:[e.jsx("td",{className:"px-4 py-2",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-right",children:t.comboQuantity}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx(j,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ie(t.id),className:"text-destructive dark:text-red-400 hover:text-destructive/80 h-7 w-7",children:e.jsx(le,{size:16})})})]},t.id))})]})})]})]}),e.jsxs(Qe,{className:"pt-8",children:[e.jsx(ze,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",onClick:h,children:"Cancel"})}),e.jsxs(j,{type:"submit",className:"bg-primary hover:bg-primary-hover dark:bg-dark-primary dark:hover:bg-dark-primary-hover text-primary-foreground dark:text-dark-primary-foreground",children:[e.jsx(Ze,{size:18,className:"mr-2"})," ",n?"Update Product":"Save Product"]})]})]})},Ne=[{sl:1,id:"PROD001",productType:"Stock",name:"Standard Widget",code:"PROD001",location:"Warehouse A",costingPrice:15.5,salesPrice:25,openingQuantity:150,units:[{id:1,name:"pcs",factor:1,isBase:!0}],baseUnitName:"pcs",openingQuantityDate:"2023-01-01",hasWarranty:!1,warrantyDays:0,category:"Widgets",description:"A standard quality widget."},{sl:2,id:"PROD002",productType:"Stock",name:"Premium Gadget",code:"PROD002",location:"Warehouse B",costingPrice:49.99,salesPrice:89.99,openingQuantity:75,units:[{id:1,name:"pcs",factor:1,isBase:!0},{id:2,name:"box",factor:5,isBase:!1}],baseUnitName:"pcs",openingQuantityDate:"2023-01-15",hasWarranty:!0,warrantyDays:365,category:"Gadgets",description:"A premium quality gadget with extra features."},{sl:3,id:"SERV001",productType:"Service",name:"Consulting Hour",code:"SERV001",location:"N/A",costingPrice:0,salesPrice:100,openingQuantity:1/0,units:[],baseUnitName:"N/A",openingQuantityDate:null,hasWarranty:!1,warrantyDays:0,category:"Services",description:"One hour of expert consulting."}],Y=u=>{var s;const h=((s=u.units)==null?void 0:s.find(o=>o.isBase))||{name:"N/A",factor:1},a=u.productType==="Service"?1/0:u.openingQuantity||0,n=u.costingPrice||0,b=u.productType==="Service"?1/0:a*n;return{...u,avgCost:n,qty:a,value:b,avgCostFormatted:n.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),qtyFormatted:u.productType==="Service"?"N/A":`${a.toLocaleString("en-US")} ${h.name}`,valueFormatted:u.productType==="Service"?"N/A":b.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),baseUnitName:h.name}},A=({children:u,columnKey:h,sortConfig:a,requestSort:n,isTextRight:b=!1,className:s=""})=>{const o=a&&a.key===h,C=o?a.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${b?"text-right":"text-left"} ${s}`,onClick:()=>n(h),children:e.jsxs("div",{className:`flex items-center ${b?"justify-end":"justify-start"}`,children:[!b&&u,e.jsx("span",{className:`mx-1 ${b?"mr-0 ml-1":"ml-0 mr-1"}`,children:o?C==="ascending"?"▲":"▼":e.jsx(dt,{size:14,className:"opacity-40"})}),b&&u]})})},kt=()=>{const{toast:u}=ke(),[h,a]=d.useState(()=>Ne.map(Y)),[n,b]=d.useState(""),[s,o]=d.useState({key:"sl",direction:"ascending"}),[C,S]=d.useState(!1),[F,V]=d.useState(null),[Q,w]=d.useState(!1),[N,U]=d.useState(null);d.useEffect(()=>{const r=localStorage.getItem("products");r?a(JSON.parse(r).map(Y)):localStorage.setItem("products",JSON.stringify(Ne))},[]);const I=r=>{localStorage.setItem("products",JSON.stringify(r.map(({avgCostFormatted:x,qtyFormatted:g,valueFormatted:c,baseUnitName:p,...D})=>D)))},T=(r=null)=>{V(r),S(!0)},z=()=>{S(!1),V(null)},E=(r,x)=>{a(g=>{let c;if(x)c=g.map(p=>p.id===r.id?Y({...p,...r}):p);else{const p=g.length>0?Math.max(...g.map($=>$.sl))+1:1,D=Y({...r,sl:p});c=[...g,D]}return I(c),c})},O=r=>{const x=h.find(g=>g.id===r);x&&(U(x),w(!0))},B=()=>{if(N){const r=h.filter(x=>x.id!==N.id);a(r),I(r),u({title:"Product Deleted",description:`${N.name} has been deleted.`,variant:"destructive"}),w(!1),U(null)}},W=()=>{u({title:"Import Products from Excel",description:"This feature will be available soon.",duration:3e3})},q=r=>b(r.target.value),f=r=>{let x="ascending";s&&s.key===r&&s.direction==="ascending"&&(x="descending"),o({key:r,direction:x})},P=d.useMemo(()=>{let r=[...h];if(n){const x=n.toLowerCase();r=r.filter(g=>Object.values(g).some(c=>String(c).toLowerCase().includes(x)))}return s!==null&&r.sort((x,g)=>{let c=x[s.key],p=g[s.key];return["avgCost","qty","value","sl","costingPrice","openingQuantity","salesPrice"].includes(s.key)?(c=c===1/0?s.direction==="ascending"?1/0:-1/0:parseFloat(c)||0,p=p===1/0?s.direction==="ascending"?1/0:-1/0:parseFloat(p)||0):typeof c=="string"&&(c=c.toLowerCase(),p=p.toLowerCase()),c<p?s.direction==="ascending"?-1:1:c>p?s.direction==="ascending"?1:-1:0}),r},[n,s,h]);return e.jsx("div",{className:"space-y-6 p-1",children:e.jsxs(_e,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(et,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(tt,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(me,{size:28,className:"mr-3 text-yellow-500 dark:text-yellow-400"})," Products & Services"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(Ee,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(ce,{size:20,className:"mr-2"})," Add New"]})}),e.jsxs(We,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(ge,{onClick:()=>T(null),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Create Product/Service"}),e.jsxs(ge,{onClick:W,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:[e.jsx(at,{size:16,className:"mr-2"})," Import from Excel"]})]})]})})]})}),e.jsxs(rt,{className:"p-4 md:p-6",children:[e.jsx(qe,{open:C,onOpenChange:S,children:e.jsxs($e,{className:"sm:max-w-2xl bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(Se,{children:[e.jsx(Ce,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:F?"Edit Product/Service":"Add New Product/Service"}),e.jsxs(Fe,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:["Fill in the details below. Fields marked with ",e.jsx("span",{className:"text-destructive dark:text-red-400",children:"*"})," are required."]})]}),e.jsx(it,{onSave:E,onCancel:z,initialData:F,isEditMode:!!F,allProducts:h})]})}),e.jsx(Le,{open:Q,onOpenChange:w,children:e.jsxs(He,{children:[e.jsxs(Ke,{children:[e.jsx(Re,{children:"Are you absolutely sure?"}),e.jsxs(Je,{children:['This action cannot be undone. This will permanently delete the product/service "',N==null?void 0:N.name,'".']})]}),e.jsxs(Ge,{children:[e.jsx(Ye,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(Me,{onClick:B,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete product/service"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(m,{type:"text",placeholder:"Search products/services (ID, Name, Base Unit...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:n,onChange:q}),e.jsxs(j,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>u({title:"Search Updated",description:`Displaying results for "${n}"`}),children:[e.jsx(st,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[800px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(A,{columnKey:"sl",sortConfig:s,requestSort:f,className:"w-16",children:"Sl"}),e.jsx(A,{columnKey:"id",sortConfig:s,requestSort:f,children:"ID"}),e.jsx(A,{columnKey:"name",sortConfig:s,requestSort:f,className:"min-w-[200px]",children:"Product Name"}),e.jsx(A,{columnKey:"productType",sortConfig:s,requestSort:f,children:"Type"}),e.jsx(A,{columnKey:"baseUnitName",sortConfig:s,requestSort:f,children:"Base Unit"}),e.jsx(A,{columnKey:"qty",sortConfig:s,requestSort:f,isTextRight:!0,children:"Quantity"}),e.jsx(A,{columnKey:"value",sortConfig:s,requestSort:f,isTextRight:!0,children:"Value"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[P.map(r=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3",children:r.sl}),e.jsx("td",{className:"px-4 py-3 text-xs font-mono",children:r.id}),e.jsx("td",{className:"px-4 py-3",children:r.name}),e.jsx("td",{className:"px-4 py-3",children:r.productType}),e.jsx("td",{className:"px-4 py-3",children:r.baseUnitName}),e.jsx("td",{className:"px-4 py-3 text-right",children:r.avgCostFormatted}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold hover:underline cursor-pointer text-primary dark:text-dark-primary",onClick:()=>u({title:`Product Ledger: ${r.name}`,description:"Detailed product ledger view coming soon."}),children:r.qtyFormatted}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:r.valueFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>T(r),children:e.jsx(ot,{size:16})}),e.jsx(j,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>O(r.id),children:e.jsx(le,{size:16})})]})]},r.id||r.sl)),P.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:n?`No products or services found for "${n}".`:"No products or services found. Add some to get started!"})})]})]})})]})]})})};export{kt as default};
