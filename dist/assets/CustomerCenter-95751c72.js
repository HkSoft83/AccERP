import{g as ge,r as t,j as e,B as N}from"./index-19c11a3b.js";import{I as C}from"./input-f9c35bba.js";import{D as He,a as qe,b as Ve,c as Ne}from"./dropdown-menu-c0986016.js";import{D as ie,a as ce,b as me,c as ye,d as _e,e as ue,f as xe}from"./dialog-50397782.js";import{A as ve,a as Se,b as Ce,c as De,d as we,e as Oe,f as Ge,g as Ke}from"./alert-dialog-9b68fe76.js";import{L as y}from"./label-02fce936.js";import{D as oe,f as K}from"./date-picker-effe6807.js";import{S as be}from"./save-c186d9d7.js";import{C as Fe,c as Te,a as Ze,b as Ye}from"./card-f4a39e41.js";import{T as te,a as se,b as I,c as g,d as ae,e as u}from"./table-8883798d.js";import{T as Qe}from"./textarea-21b2dcf0.js";import{T as Xe,a as We,b as de,c as ne}from"./tabs-1d693252.js";import{S as Ae}from"./search-d8f0529c.js";import{p as _,F as er}from"./parseISO-42087f07.js";import{E as rr}from"./eye-eaa3f4ac.js";import{P as he}from"./pen-square-87558480.js";import{T as pe}from"./trash-2-c0139f04.js";import{P as Be}from"./plus-circle-fb03b45f.js";import{U as tr}from"./user-0487be61.js";import{A as sr}from"./arrow-up-down-708a555d.js";import"./index-a59de778.js";import"./check-3cb4d2e5.js";const ar=({onSave:n,onCancel:D,initialData:m,isEditMode:i})=>{const{toast:k}=ge(),[x,L]=t.useState(""),[v,$]=t.useState(""),[w,P]=t.useState(""),[U,F]=t.useState(""),[S,J]=t.useState(""),[c,H]=t.useState(""),[T,M]=t.useState(""),[G,A]=t.useState(""),[j,R]=t.useState(""),[q,z]=t.useState(""),[O,B]=t.useState(""),[s,h]=t.useState(void 0),[b,f]=t.useState(null);t.useEffect(()=>{var d;i&&m?(L(m.name||""),$(m.displayName||""),P(m.proprietorName||""),F(m.customerNumber||""),J(m.phoneNumber||""),H(m.address||""),M(m.nid||""),A(m.extraField1||""),R(m.extraField2||""),z(m.extraField3||""),B(((d=m.openingBalance)==null?void 0:d.toString())||""),h(m.openingBalanceDate?new Date(m.openingBalanceDate):void 0),f(m.id||m.customerNumber)):l()},[m,i]);const l=()=>{L(""),$(""),P(""),F(""),J(""),H(""),M(""),A(""),R(""),z(""),B(""),h(void 0),f(null)},Z=(d,Y=!0)=>{if(d.preventDefault(),!x){k({title:"Validation Error",description:"Customer Name is required.",variant:"destructive"});return}const V={id:b||`cust-${Date.now()}`,name:x,displayName:v,proprietorName:w,customerNumber:U||(b?b.split("-")[1]||String(Date.now()).slice(-4):`C${String(Date.now()).slice(-4)}`),phoneNumber:S,address:c,nid:T,extraField1:G,extraField2:j,extraField3:q,openingBalance:parseFloat(O)||0,openingBalanceDate:s?s.toISOString().split("T")[0]:null};n(V,i),k({title:`Customer ${i?"Updated":"Saved"}!`,description:`${x} has been successfully ${i?"updated":"added"}.`}),Y?D():i||l()};return e.jsxs("form",{onSubmit:d=>Z(d,!0),className:"space-y-4 py-2",children:[e.jsxs(ie,{className:"hidden",children:[e.jsx(ce,{children:i?"Edit Customer":"Add New Customer"}),e.jsx(me,{children:i?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"customerName",children:["Customer Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(C,{id:"customerName",value:x,onChange:d=>L(d.target.value),placeholder:"e.g., Client Omega Corp.",className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"displayName",children:"Display Name"}),e.jsx(C,{id:"displayName",value:v,onChange:d=>$(d.target.value),placeholder:"e.g., Omega Corp.",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"proprietorName",children:"Proprietor Name"}),e.jsx(C,{id:"proprietorName",value:w,onChange:d=>P(d.target.value),placeholder:"e.g., Jane Smith",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"customerNumber",children:"Customer Number"}),e.jsx(C,{id:"customerNumber",value:U,onChange:d=>F(d.target.value),placeholder:"e.g., C001",className:"mt-1",disabled:i}),i&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Customer number cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(C,{id:"phoneNumber",value:S,onChange:d=>J(d.target.value),placeholder:"e.g., +1234567890",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"address",children:"Address"}),e.jsx(C,{id:"address",value:c,onChange:d=>H(d.target.value),placeholder:"e.g., 456 Client Ave",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"nid",children:"NID"}),e.jsx(C,{id:"nid",value:T,onChange:d=>M(d.target.value),placeholder:"e.g., 1234567890",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"extraField1",children:"Extra Field 1"}),e.jsx(C,{id:"extraField1",value:G,onChange:d=>A(d.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"extraField2",children:"Extra Field 2"}),e.jsx(C,{id:"extraField2",value:j,onChange:d=>R(d.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"extraField3",children:"Extra Field 3"}),e.jsx(C,{id:"extraField3",value:q,onChange:d=>z(d.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"openingBalance",children:"Opening Balance"}),e.jsx(C,{id:"openingBalance",type:"number",value:O,onChange:d=>B(d.target.value),placeholder:"0.00",className:"mt-1",disabled:i}),i&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"openingBalanceDate",children:"Opening Balance As of Date"}),e.jsx(oe,{date:s,setDate:h,className:"mt-1 w-full",disabled:i}),i&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance date cannot be changed after creation."})]}),e.jsxs(ye,{className:"pt-6",children:[e.jsx(_e,{asChild:!0,children:e.jsx(N,{variant:"outline",onClick:D,children:"Cancel"})}),!i&&e.jsxs(N,{type:"button",onClick:d=>Z(d,!1),variant:"secondary",children:[e.jsx(be,{size:18,className:"mr-2"})," Save & New"]}),e.jsxs(N,{type:"submit",children:[e.jsx(be,{size:18,className:"mr-2"})," ",i?"Update Customer":"Save & Close"]})]})]})},dr=({customerId:n,customerName:D,onClose:m,onEditCustomer:i})=>{const{toast:k}=ge(),[x,L]=t.useState([]),[v,$]=t.useState([]),[w,P]=t.useState(null),[U,F]=t.useState(null),[S,J]=t.useState(""),[c,H]=t.useState(null),[T,M]=t.useState([]),[G,A]=t.useState(!1),[j,R]=t.useState(null),[q,z]=t.useState(""),[O,B]=t.useState(""),[s,h]=t.useState(null),[b,f]=t.useState([]),[l,Z]=t.useState(null),[d,Y]=t.useState(null),[V,fe]=t.useState(null),[Ee,ee]=t.useState(!1),[Ie,re]=t.useState(!1);t.useEffect(()=>{if(j)z(j.title||""),B(j.description||""),h(j.reminderTime?_(j.reminderTime):null);else{z(""),B("");const r=new Date;r.setHours(10,0,0,0),h(r)}},[j]),t.useEffect(()=>{if(n){const r=JSON.parse(localStorage.getItem(`customer_${n}_notes`))||[];M(r)}},[n]);const Le=()=>{if(!q||!O){k({title:"Error",description:"Title and Description are required for a note.",variant:"destructive"});return}const r={id:j?j.id:`note-${Date.now()}`,title:q,description:O,reminderTime:s?s.toISOString():null,creationDate:j?j.creationDate:new Date().toISOString()};let a;j?(a=T.map(p=>p.id===r.id?r:p),k({title:"Success",description:"Note updated successfully."})):(a=[...T,r],k({title:"Success",description:"Note added successfully."})),localStorage.setItem(`customer_${n}_notes`,JSON.stringify(a)),M(a),A(!1),R(null),z(""),B(""),h(null)},Me=r=>{R(r),A(!0)},ze=r=>{const a=T.filter(p=>p.id!==r);localStorage.setItem(`customer_${n}_notes`,JSON.stringify(a)),M(a),k({title:"Success",description:"Note deleted successfully."})},$e=r=>{Z(r),ee(!0)},Pe=r=>{Y(r),ee(!0)},Ue=r=>{fe(r),re(!0)},Je=()=>{if(V){const a=JSON.parse(localStorage.getItem("salesOrders")||"[]").filter(p=>p.orderNumber!==V.orderNumber);localStorage.setItem("salesOrders",JSON.stringify(a)),f(a.filter(p=>p.customer===n)),k({title:"Order Deleted",description:`Sales Order ${V.orderNumber} has been deleted.`,variant:"destructive"}),re(!1),fe(null)}};t.useEffect(()=>{const a=(JSON.parse(localStorage.getItem("customers"))||[]).find(p=>p.id===n);H(a)},[n]),t.useEffect(()=>{if(!n)return;const r=JSON.parse(localStorage.getItem("salesInvoices"))||[],a=JSON.parse(localStorage.getItem("receipts"))||[],p=JSON.parse(localStorage.getItem("salesReturns"))||[],Q=JSON.parse(localStorage.getItem("creditNotes"))||[],E=[];r.filter(o=>o.customerId===n).forEach(o=>{var X;return E.push({date:_(o.invoiceDate),type:"Sales Invoice",ref:o.invoiceNumber,narration:`Invoice for ${((X=o.lineItems)==null?void 0:X.length)||0} items`,debit:parseFloat(o.grandTotal)||0,credit:0})}),a.filter(o=>o.receivedFrom===n).forEach(o=>E.push({date:_(o.date),type:"Receipt",ref:o.receiptNumber,narration:o.narration||"Payment received",debit:0,credit:parseFloat(o.amount)||0})),p.filter(o=>o.customerId===n).forEach(o=>{var X;return E.push({date:_(o.returnDate),type:"Sales Return",ref:o.returnNumber,narration:`Return of ${((X=o.lineItems)==null?void 0:X.length)||0} items`,debit:0,credit:parseFloat(o.grandTotal)||0})}),Q.filter(o=>o.debitAccount===n).forEach(o=>E.push({date:_(o.date),type:"Credit Note",ref:o.creditNoteNumber,narration:o.narration||"Credit issued",debit:0,credit:parseFloat(o.amount)||0})),L(E)},[n]);const je=t.useMemo(()=>{if(!c)return[];let r=c.openingBalance;const a=c.openingBalanceDate?_(c.openingBalanceDate):new Date(new Date().getFullYear(),0,1),p=[];return p.push({date:a,type:"Opening Balance",ref:"-",narration:"Opening Balance",debit:c.openingBalance>=0?c.openingBalance:0,credit:c.openingBalance<0?Math.abs(c.openingBalance):0,balance:r}),[...x].sort((E,o)=>E.date-o.date).forEach(E=>{r+=(E.debit||0)-(E.credit||0),p.push({...E,balance:r})}),p},[x,c]);t.useEffect(()=>{let r=je;if(w&&(r=r.filter(a=>a.date>=w)),U&&(r=r.filter(a=>a.date<=U)),S){const a=S.toLowerCase();r=r.filter(p=>p.type.toLowerCase().includes(a)||p.ref.toLowerCase().includes(a)||p.narration.toLowerCase().includes(a))}$(r)},[je,w,U,S]);const Re=()=>{P(null),F(null),J("")};return t.useEffect(()=>{if(n){const a=(JSON.parse(localStorage.getItem("salesOrders"))||[]).filter(p=>p.customer===n);f(a)}},[n]),e.jsx(Fe,{className:"shadow-xl border-border dark:border-dark-border",children:e.jsxs(Te,{className:"p-4 md:p-6 space-y-4",children:[c&&e.jsxs("div",{className:"relative p-3 bg-primary/5 dark:bg-dark-primary/10 rounded-md border border-primary/20 dark:border-dark-primary/20 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:c.name}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Customer ID: ",c.customerNumber||c.id]}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Address: ",c.address||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Phone: ",c.phoneNumber||"N/A"," | Email: ",c.email||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Credit Limit: ",c.creditLimit?parseFloat(c.creditLimit).toLocaleString("en-US",{style:"currency",currency:"USD"}):"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Bank Details: ",c.bankDetails||"N/A"]}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground mt-2",children:["Notes: ",c.notes||"N/A"]})]}),e.jsxs(Xe,{defaultValue:"transactions",className:"w-full",children:[e.jsxs(We,{className:"grid w-full grid-cols-4",children:[e.jsx(de,{value:"transactions",children:"Transactions"}),e.jsx(de,{value:"sales-orders",children:"Sales Orders"}),e.jsx(de,{value:"notes",children:"Notes"}),e.jsx(de,{value:"attachments",children:"Attachments"})]}),e.jsxs(ne,{value:"transactions",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"startDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"From Date"}),e.jsx(oe,{date:w,setDate:P,id:"startDate",placeholder:"Start Date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"endDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"To Date"}),e.jsx(oe,{date:U,setDate:F,id:"endDate",placeholder:"End Date"})]}),e.jsxs("div",{className:"relative flex-grow w-full sm:w-auto",children:[e.jsx(Ae,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground dark:text-dark-muted-foreground"}),e.jsx(C,{type:"search",placeholder:"Search transactions...",value:S,onChange:r=>J(r.target.value),className:"pl-8 w-full"})]}),e.jsxs(N,{onClick:Re,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[e.jsx(er,{size:16,className:"mr-2"})," Clear Filters"]})]}),e.jsx("div",{className:"overflow-x-auto border border-border dark:border-dark-border rounded-lg",children:e.jsxs(te,{children:[e.jsx(se,{className:"bg-muted dark:bg-dark-muted",children:e.jsxs(I,{children:[e.jsx(g,{className:"w-[50px]",children:"Sl No"}),e.jsx(g,{className:"w-[100px]",children:"Date"}),e.jsx(g,{children:"Type / Ref#"}),e.jsx(g,{children:"Narration"}),e.jsx(g,{className:"text-right",children:"Debit"}),e.jsx(g,{className:"text-right",children:"Credit"}),e.jsx(g,{className:"text-right",children:"Balance"})]})}),e.jsx(ae,{children:v.length>0?v.map((r,a)=>e.jsxs(I,{className:"hover:bg-muted/50 dark:hover:bg-dark-muted/50",children:[e.jsx(u,{children:a+1}),e.jsx(u,{children:K(r.date,"dd-MMM-yy")}),e.jsxs(u,{children:[e.jsx("div",{className:"font-medium",children:r.type}),e.jsx("div",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground",children:r.ref})]}),e.jsx(u,{children:r.narration}),e.jsx(u,{className:"text-right",children:(r.debit||0)>0?(r.debit||0).toFixed(2):"-"}),e.jsx(u,{className:"text-right",children:(r.credit||0)>0?(r.credit||0).toFixed(2):"-"}),e.jsx(u,{className:"text-right font-semibold",children:r.balance.toFixed(2)})]},a)):e.jsx(I,{children:e.jsx(u,{colSpan:6,className:"text-center h-24 text-muted-foreground dark:text-dark-muted-foreground",children:"No transactions found for this customer."})})})]})}),v.length>0&&e.jsxs("div",{className:"flex justify-end pt-2 text-sm font-semibold text-primary dark:text-dark-primary",children:["Final Balance: ",v[v.length-1].balance.toFixed(2),v[v.length-1].balance>=0?" (Receivable)":" (Payable)"]})]}),e.jsxs(ne,{value:"sales-orders",className:"space-y-4 pt-4",children:[e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs(te,{className:"min-w-[800px]",children:[e.jsx(se,{className:"bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs(I,{children:[e.jsx(g,{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Order No."}),e.jsx(g,{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Order Date"}),e.jsx(g,{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Memo"}),e.jsx(g,{className:"px-4 py-3 text-right text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Total Amount"}),e.jsx(g,{className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Status"}),e.jsx(g,{className:"px-4 py-3 text-center text-xs font-medium text-muted-foreground dark:text-dark-muted-foreground uppercase tracking-wider",children:"Action"})]})}),e.jsx(ae,{className:"bg-card dark:bg-dark-card divide-y divide-border dark:divide-dark-border",children:b.length>0?b.map(r=>{const a=r.lineItems.reduce((p,Q)=>p+Q.rateForBillingUnit*Q.quantityInput,0);return e.jsxs(I,{children:[e.jsx(u,{className:"px-4 py-3 text-muted-foreground dark:text-dark-muted-foreground",children:r.orderNumber}),e.jsx(u,{className:"px-4 py-3 text-muted-foreground dark:text-dark-muted-foreground",children:K(new Date(r.orderDate),"dd-MMM-yyyy")}),e.jsx(u,{className:"px-4 py-3 text-muted-foreground dark:text-dark-muted-foreground",children:r.memo||"-"}),e.jsx(u,{className:"px-4 py-3 text-right font-semibold text-foreground dark:text-dark-foreground",children:a.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx(u,{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.isDraft?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:r.isDraft?"Draft":"Finalized"})}),e.jsxs(u,{className:"px-4 py-3 text-center space-x-2",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"text-blue-600 hover:text-blue-800",onClick:()=>$e(r),children:e.jsx(rr,{size:18})}),e.jsx(N,{variant:"ghost",size:"icon",className:"text-green-600 hover:text-green-800",onClick:()=>Pe(r),children:e.jsx(he,{size:18})}),e.jsx(N,{variant:"ghost",size:"icon",className:"text-red-600 hover:text-red-800",onClick:()=>Ue(r),children:e.jsx(pe,{size:18})})]})]},r.orderNumber)}):e.jsx(I,{children:e.jsx(u,{colSpan:6,className:"h-24 text-center text-muted-foreground dark:text-dark-muted-foreground",children:"No sales orders found for this customer."})})})]})}),e.jsx(ue,{open:Ee||!!l,onOpenChange:r=>{r||(ee(!1),Z(null),Y(null))},children:e.jsxs(xe,{className:"sm:max-w-[1200px] h-[90vh] bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(ie,{children:[e.jsx(ce,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:l?"Sales Order Details":d?"Edit Sales Order":"Create New Sales Order"}),e.jsx(me,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:l?"Details of the selected sales order.":d?"Edit the details of the sales order.":"Fill in the details to create a new sales order."})]}),l?e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Order Number:"})," ",l.orderNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Customer:"})," ",D||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Order Date:"})," ",K(new Date(l.orderDate),"dd-MMM-yyyy")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected Delivery Date:"})," ",K(new Date(l.expectedDeliveryDate),"dd-MMM-yyyy")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Memo:"})," ",l.memo||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Shipping Address:"})," ",l.shippingAddress||"N/A"]}),e.jsx("h4",{className:"font-semibold mt-4",children:"Line Items:"}),e.jsxs(te,{children:[e.jsx(se,{children:e.jsxs(I,{children:[e.jsx(g,{children:"Product"}),e.jsx(g,{children:"Quantity"}),e.jsx(g,{children:"Rate"}),e.jsx(g,{children:"Discount"})]})}),e.jsx(ae,{children:l.lineItems.map((r,a)=>e.jsxs(I,{children:[e.jsx(u,{children:r.productName}),e.jsxs(u,{children:[r.quantityInput," ",r.quantityUnitName]}),e.jsxs(u,{children:[r.rateForBillingUnit," per ",r.billingUnitName]}),e.jsx(u,{children:r.discountPercent>0?`${r.discountPercent}%`:r.discountAmount>0?`${r.discountAmount}`:"N/A"})]},a))})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Notes:"})," ",l.notes||"N/A"]})]}):e.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[e.jsx("p",{children:"Sales Order Form will be implemented here."}),e.jsx(N,{onClick:()=>{ee(!1),Y(null)},children:"Close"})]})]})}),e.jsx(ve,{open:Ie,onOpenChange:re,children:e.jsxs(Se,{children:[e.jsxs(Ce,{children:[e.jsx(De,{children:"Are you absolutely sure?"}),e.jsxs(we,{children:['This action cannot be undone. This will permanently delete the sales order "',V==null?void 0:V.orderNumber,'".']})]}),e.jsxs(Oe,{children:[e.jsx(N,{variant:"outline",onClick:()=>re(!1),children:"Cancel"}),e.jsx(N,{variant:"destructive",onClick:Je,children:"Yes, delete order"})]})]})})]}),e.jsxs(ne,{value:"notes",children:[e.jsxs("div",{className:"p-4 text-muted-foreground dark:text-dark-muted-foreground",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(N,{onClick:()=>{A(!0),R(null)},children:[e.jsx(Be,{size:18,className:"mr-2"})," Add New Note"]})}),e.jsx("div",{className:"overflow-x-auto border border-border dark:border-dark-border rounded-lg",children:e.jsxs(te,{children:[e.jsx(se,{className:"bg-muted dark:bg-dark-muted",children:e.jsxs(I,{children:[e.jsx(g,{className:"w-[50px]",children:"Sl No"}),e.jsx(g,{children:"Creation Date"}),e.jsx(g,{children:"Title"}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Reminder Time"}),e.jsx(g,{className:"text-center w-[120px]",children:"Action"})]})}),e.jsx(ae,{children:T.length>0?T.map((r,a)=>e.jsxs(I,{className:"hover:bg-muted/50 dark:hover:bg-dark-muted/50",children:[e.jsx(u,{children:a+1}),e.jsx(u,{children:r.creationDate?K(_(r.creationDate),"dd-MMM-yyyy HH:mm"):"N/A"}),e.jsx(u,{children:r.title}),e.jsx(u,{children:r.description}),e.jsx(u,{children:r.reminderTime?K(_(r.reminderTime),"dd-MMM-yyyy HH:mm"):"N/A"}),e.jsxs(u,{className:"text-center space-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>Me(r),children:e.jsx(he,{size:16})}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>ze(r.id),children:e.jsx(pe,{size:16})})]})]},r.id)):e.jsx(I,{children:e.jsx(u,{colSpan:6,className:"text-center h-24 text-muted-foreground dark:text-dark-muted-foreground",children:"No notes found for this customer."})})})]})})]}),e.jsx(ue,{open:G,onOpenChange:A,children:e.jsxs(xe,{className:"sm:max-w-[425px]",children:[e.jsxs(ie,{children:[e.jsx(ce,{children:j?"Edit Note":"Add New Note"}),e.jsx(me,{children:j?"Edit the details of your note.":"Add a new note for this customer."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"noteTitle",className:"text-right",children:"Title"}),e.jsx(C,{id:"noteTitle",value:q,onChange:r=>z(r.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"noteDescription",className:"text-right",children:"Description"}),e.jsx(Qe,{id:"noteDescription",value:O,onChange:r=>B(r.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(y,{htmlFor:"noteReminderTime",className:"text-right",children:"Reminder Time"}),e.jsx(oe,{date:s,setDate:r=>{r&&r.setHours(10,0,0,0),h(r)},id:"noteReminderTime",className:"col-span-3"})]})]}),e.jsxs(ye,{children:[e.jsx(N,{variant:"outline",onClick:()=>A(!1),children:"Cancel"}),e.jsx(N,{onClick:Le,children:j?"Save Changes":"Add Note"})]})]})})]}),e.jsx(ne,{value:"attachments",children:e.jsx("div",{className:"p-4 text-muted-foreground dark:text-dark-muted-foreground",children:"Attachments content will go here."})})]})]})})},ke=[{id:"cust-001",name:"Client Omega Corp.",displayName:"Omega Corp.",proprietorName:"Mr. O",customerNumber:"C001",address:"123 Omega St",balance:2800,openingBalance:2800,openingBalanceDate:"2023-01-01"},{id:"cust-002",name:"Customer Zeta Ltd.",displayName:"Zeta Ltd.",proprietorName:"Ms. Z",customerNumber:"C002",address:"456 Zeta Ave",balance:0,openingBalance:0,openingBalanceDate:"2023-01-01"},{id:"cust-003",name:"Patron Gamma Solutions",displayName:"Gamma Solutions",proprietorName:"Dr. G",customerNumber:"C003",address:"789 Gamma Rd",balance:5120.75,openingBalance:5120.75,openingBalanceDate:"2023-01-01"},{id:"cust-004",name:"Client Alpha Services",displayName:"Alpha Services",proprietorName:"Prof. A",customerNumber:"C004",address:"012 Alpha Blvd",balance:-300,openingBalance:-300,openingBalanceDate:"2023-01-01"}],le=n=>({...n,balanceFormatted:(n.balance||0).toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),W=({children:n,columnKey:D,sortConfig:m,requestSort:i,isTextRight:k=!1,className:x=""})=>{const L=m&&m.key===D,v=L?m.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${k?"text-right":"text-left"} ${x}`,onClick:()=>i(D),children:e.jsxs("div",{className:`flex items-center ${k?"justify-end":"justify-start"}`,children:[!k&&n,e.jsx("span",{className:`mx-1 ${k?"mr-0 ml-1":"ml-0 mr-1"}`,children:L?v==="ascending"?"▲":"▼":e.jsx(sr,{size:14,className:"opacity-40"})}),k&&n]})})},Or=()=>{const{toast:n}=ge(),[D,m]=t.useState(()=>ke.map(le)),[i,k]=t.useState(""),[x,L]=t.useState({key:"name",direction:"ascending"}),[v,$]=t.useState(!1),[w,P]=t.useState(null),[U,F]=t.useState(!1),[S,J]=t.useState(null),[c,H]=t.useState(null);t.useEffect(()=>{const s=localStorage.getItem("customers");s?m(JSON.parse(s).map(le)):localStorage.setItem("customers",JSON.stringify(ke))},[]);const T=s=>{localStorage.setItem("customers",JSON.stringify(s.map(({balanceFormatted:h,...b})=>b)))},M=(s=null)=>{P(s),$(!0)},G=()=>{$(!1),P(null)},A=(s,h)=>{m(b=>{let f;if(h)f=b.map(l=>l.id===s.id?le({...l,...s,balance:s.openingBalance}):l);else{const l=le({...s,balance:s.openingBalance});f=[...b,l]}return T(f),f})},j=s=>{const h=D.find(b=>b.id===s);h&&(J(h),F(!0))},R=()=>{if(S){const s=D.filter(h=>h.id!==S.id);m(s),T(s),n({title:"Customer Deleted",description:`${S.name} has been deleted.`,variant:"destructive"}),F(!1),J(null)}},q=()=>{n({title:"Import Customers from Excel",description:"This feature will be available soon.",duration:3e3})},z=s=>k(s.target.value),O=s=>{let h="ascending";x&&x.key===s&&x.direction==="ascending"&&(h="descending"),L({key:s,direction:h})},B=t.useMemo(()=>{let s=[...D];if(i){const h=i.toLowerCase();s=s.filter(b=>{var f;return Object.values(b).some(l=>String(l).toLowerCase().includes(h))||((f=b.displayName)==null?void 0:f.toLowerCase().includes(h))})}return x!==null&&s.sort((h,b)=>{let f=h[x.key],l=b[x.key];return x.key==="balance"?(f=parseFloat(f)||0,l=parseFloat(l)||0):typeof f=="string"&&(f=f.toLowerCase(),l=l.toLowerCase()),f<l?x.direction==="ascending"?-1:1:f>l?x.direction==="ascending"?1:-1:0}),s},[i,x,D]);return e.jsx("div",{className:"space-y-6 p-1",children:c?e.jsx(dr,{customerId:c.id,customerName:c.name,onClose:()=>H(null)}):e.jsxs(Fe,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(Ze,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(Ye,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(tr,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Customer Center"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(He,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(Be,{size:20,className:"mr-2"})," Add Customer"]})}),e.jsxs(Ve,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(Ne,{onClick:()=>M(null),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Add New"}),e.jsx(Ne,{onClick:q,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Import from Excel"})]})]})})]})}),e.jsxs(Te,{className:"p-4 md:p-6",children:[e.jsx(ue,{open:v,onOpenChange:$,children:e.jsxs(xe,{className:"sm:max-w-[550px] bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(ie,{children:[e.jsx(ce,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:w?"Edit Customer":"Add New Customer"}),e.jsx(me,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:w?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsx(ar,{onSave:A,onCancel:G,initialData:w,isEditMode:!!w})]})}),e.jsx(ve,{open:U,onOpenChange:F,children:e.jsxs(Se,{children:[e.jsxs(Ce,{children:[e.jsx(De,{children:"Are you absolutely sure?"}),e.jsxs(we,{children:['This action cannot be undone. This will permanently delete the customer "',S==null?void 0:S.name,'".']})]}),e.jsxs(Oe,{children:[e.jsx(Ge,{onClick:()=>F(!1),children:"Cancel"}),e.jsx(Ke,{onClick:R,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete customer"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(C,{type:"text",placeholder:"Search customers (Name, Balance...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:i,onChange:z}),e.jsxs(N,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>n({title:"Search Updated",description:`Displaying results for "${i}"`}),children:[e.jsx(Ae,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[600px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(W,{columnKey:"name",sortConfig:x,requestSort:O,className:"min-w-[150px]",children:"Customer Name"}),e.jsx(W,{columnKey:"displayName",sortConfig:x,requestSort:O,className:"min-w-[150px]",children:"Display Name"}),e.jsx(W,{columnKey:"address",sortConfig:x,requestSort:O,children:"Address"}),e.jsx(W,{columnKey:"phoneNumber",sortConfig:x,requestSort:O,children:"Phone Number"}),e.jsx(W,{columnKey:"balance",sortConfig:x,requestSort:O,isTextRight:!0,children:"Balance"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[B.map(s=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-secondary dark:text-dark-secondary hover:underline cursor-pointer",onClick:()=>H(s),children:s.name}),e.jsx("td",{className:"px-4 py-3",children:s.displayName}),e.jsx("td",{className:"px-4 py-3",children:s.address}),e.jsx("td",{className:"px-4 py-3",children:s.phoneNumber}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:s.balanceFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>M(s),children:e.jsx(he,{size:16})}),e.jsx(N,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>j(s.id),children:e.jsx(pe,{size:16})})]})]},s.id)),B.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:i?`No customers found for "${i}".`:"No customers found. Start by adding a customer!"})})]})]})})]})]})})};export{Or as default};
