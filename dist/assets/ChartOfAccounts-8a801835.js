import{c as Re,r as c,a as Ie,u as fe,j as e,P as ne,b as ue,d as Pe,e as Ue,R as ye,f as me,g as je,B as D,C as _e,h as He}from"./index-6ef9a250.js";import{I as Q}from"./input-6aebf58f.js";import{u as $e,D as ze,a as qe,b as Me,c as xe}from"./dropdown-menu-8cb8afd1.js";import{D as Ne,a as ke,b as ve,c as Ke,d as Ve,e as Ge,f as Je}from"./dialog-4ddb2f0f.js";import{A as Xe,a as Ye,b as Qe,c as We,d as Ze,e as et,f as tt,g as at}from"./alert-dialog-0c4287f2.js";import{L as H}from"./label-2748d824.js";import{D as rt}from"./date-picker-896cb7c2.js";import{S as te,a as ae,b as re,c as se,d as X}from"./select-5a7be211.js";import{C as st}from"./check-0fdc0954.js";import{S as pe}from"./save-6a252b25.js";import{C as nt,a as ct,b as lt,c as dt}from"./card-19b38789.js";import{F as ot}from"./file-down-9dcf6ff6.js";import{P as he}from"./plus-circle-3765d736.js";import{S as it}from"./search-a497960d.js";import{P as ut}from"./pen-square-0e7179e0.js";import{T as mt}from"./trash-2-d896a3b4.js";import{A as xt}from"./arrow-up-down-9a395eed.js";import"./index-3b8b6dae.js";const be=Re("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function pt(t){const o=c.useRef({value:t,previous:t});return c.useMemo(()=>(o.current.value!==t&&(o.current.previous=o.current.value,o.current.value=t),o.current.previous),[t])}var W="Checkbox",[ht,qt]=Ie(W),[bt,ce]=ht(W);function gt(t){const{__scopeCheckbox:o,checked:x,children:d,defaultChecked:s,disabled:r,form:j,name:f,onCheckedChange:g,required:N,value:h="on",internal_do_not_use_render:u}=t,[m,k]=Ue({prop:x,defaultProp:s??!1,onChange:g,caller:W}),[S,B]=c.useState(null),[w,y]=c.useState(null),p=c.useRef(!1),O=S?!!j||!!S.closest("form"):!0,T={checked:m,disabled:r,setChecked:k,control:S,setControl:B,name:f,form:j,value:h,hasConsumerStoppedPropagationRef:p,required:N,defaultChecked:_(s)?!1:s,isFormControl:O,bubbleInput:w,setBubbleInput:y};return e.jsx(bt,{scope:o,...T,children:ft(u)?u(T):d})}var Se="CheckboxTrigger",Ce=c.forwardRef(({__scopeCheckbox:t,onKeyDown:o,onClick:x,...d},s)=>{const{control:r,value:j,disabled:f,checked:g,required:N,setControl:h,setChecked:u,hasConsumerStoppedPropagationRef:m,isFormControl:k,bubbleInput:S}=ce(Se,t),B=fe(s,h),w=c.useRef(g);return c.useEffect(()=>{const y=r==null?void 0:r.form;if(y){const p=()=>u(w.current);return y.addEventListener("reset",p),()=>y.removeEventListener("reset",p)}},[r,u]),e.jsx(ne.button,{type:"button",role:"checkbox","aria-checked":_(g)?"mixed":g,"aria-required":N,"data-state":Oe(g),"data-disabled":f?"":void 0,disabled:f,value:j,...d,ref:B,onKeyDown:ue(o,y=>{y.key==="Enter"&&y.preventDefault()}),onClick:ue(x,y=>{u(p=>_(p)?!0:!p),S&&k&&(m.current=y.isPropagationStopped(),m.current||y.stopPropagation())})})});Ce.displayName=Se;var le=c.forwardRef((t,o)=>{const{__scopeCheckbox:x,name:d,checked:s,defaultChecked:r,required:j,disabled:f,value:g,onCheckedChange:N,form:h,...u}=t;return e.jsx(gt,{__scopeCheckbox:x,checked:s,defaultChecked:r,disabled:f,required:j,onCheckedChange:N,name:d,form:h,value:g,internal_do_not_use_render:({isFormControl:m})=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{...u,ref:o,__scopeCheckbox:x}),m&&e.jsx(Be,{__scopeCheckbox:x})]})})});le.displayName=W;var Ae="CheckboxIndicator",we=c.forwardRef((t,o)=>{const{__scopeCheckbox:x,forceMount:d,...s}=t,r=ce(Ae,x);return e.jsx(Pe,{present:d||_(r.checked)||r.checked===!0,children:e.jsx(ne.span,{"data-state":Oe(r.checked),"data-disabled":r.disabled?"":void 0,...s,ref:o,style:{pointerEvents:"none",...t.style}})})});we.displayName=Ae;var De="CheckboxBubbleInput",Be=c.forwardRef(({__scopeCheckbox:t,...o},x)=>{const{control:d,hasConsumerStoppedPropagationRef:s,checked:r,defaultChecked:j,required:f,disabled:g,name:N,value:h,form:u,bubbleInput:m,setBubbleInput:k}=ce(De,t),S=fe(x,k),B=pt(r),w=$e(d);c.useEffect(()=>{const p=m;if(!p)return;const O=window.HTMLInputElement.prototype,L=Object.getOwnPropertyDescriptor(O,"checked").set,R=!s.current;if(B!==r&&L){const P=new Event("click",{bubbles:R});p.indeterminate=_(r),L.call(p,_(r)?!1:r),p.dispatchEvent(P)}},[m,B,r,s]);const y=c.useRef(_(r)?!1:r);return e.jsx(ne.input,{type:"checkbox","aria-hidden":!0,defaultChecked:j??y.current,required:f,disabled:g,name:N,value:h,form:u,...o,tabIndex:-1,ref:S,style:{...o.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Be.displayName=De;function ft(t){return typeof t=="function"}function _(t){return t==="indeterminate"}function Oe(t){return _(t)?"indeterminate":t?"checked":"unchecked"}const yt=ye.forwardRef(({className:t,...o},x)=>e.jsx(le,{ref:x,className:me("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...o,children:e.jsx(we,{className:me("flex items-center justify-center text-current"),children:e.jsx(st,{className:"h-4 w-4"})})}));yt.displayName=le.displayName;const Te={"Current Asset":["Cash","Bank A/C-Current","Bank A/C-Saving","Account Receivable","Inventory","Short-Term Investments","Prepaid Expenses","Loans & Advances (Short-Term)","Other Current Assets"],"Non-Current Asset":["Fixed/Tangible Assets","Intangible Assets","Long-term Investments","Other Non-Current Assets"],"Current Liability":["A/C Payable","Short-term Loan","Accrued Expenses","Credit Card","Unearned Revenue","Provisions","Current Portion of Long-term Debt","Other Current Liabilities"],"Non-Current Liability":["Long-term Loans","Bonds Payable","Provisions","Deferred Tax Liabilities","Other Non-Current Liabilities"],Equity:["Owner's Capital","Owner's Drawings","Retained Earnings","Share Capital","Reserves & Surplus","Others Equity"],Income:["Operating Income","Non-operating Income","Other Income"],Expense:["Operating Expenses","Non-Operating Expenses","Others Expenses","Cost of Goods Sold"]},jt=Object.keys(Te),M="__none__",Nt=({existingAccounts:t=[],onSave:o,onCancel:x,initialData:d,isEditMode:s,initialSubAccountData:r})=>{var b;const{toast:j}=je(),[f,g]=c.useState(""),[N,h]=c.useState(""),[u,m]=c.useState(""),[k,S]=c.useState(""),[B,w]=c.useState(M),[y,p]=c.useState(""),[O,T]=c.useState(void 0),[L,R]=c.useState(null);c.useEffect(()=>{var l;console.log("AddAccountForm useEffect - initialData:",d),console.log("AddAccountForm useEffect - isEditMode:",s),s&&d?(g(d.accName||""),h(d.accNum||""),m(d.accType||""),S(d.isHeader?"":d.accSubtype||""),w(d.subAccountOf||M),p(((l=d.openingBalance)==null?void 0:l.toString())||""),T(d.openingBalanceDate?new Date(d.openingBalanceDate):void 0),R(d.id||d.accNum)):r?(w(r.accNum||M),m(r.accType||""),S(r.accSubtype||""),g(""),h(""),p(""),T(void 0),R(null)):P()},[d,s,r,t]);const P=()=>{g(""),h(""),m(""),S(""),w(M),p(""),T(void 0),R(null)},n=(l,V=!0)=>{if(l.preventDefault(),!f||!u){j({title:"Validation Error",description:"Account Name and Account Type are required.",variant:"destructive"});return}const Z={id:L||`acc-${Date.now()}`,accName:f,accNum:N||L&&L.split("-")[1]||String(Date.now()).slice(-4),accType:u,accSubtype:k,subAccountOf:B===M?null:B,openingBalance:parseFloat(y)||0,openingBalanceDate:O?O.toISOString().split("T")[0]:null,isHeader:!1};o(Z,s),j({title:`Account ${s?"Updated":"Saved"}!`,description:`${f} has been successfully ${s?"updated":"added"}.`}),V?x():s||P()};return e.jsxs("form",{onSubmit:l=>n(l,!0),className:"space-y-4 py-2",children:[console.log("Rendering AddAccountForm with:",{accountType:u,accountSubtype:k,subAccountOf:B}),e.jsxs(Ne,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx(ke,{children:s?"Edit Account":"Add New Account"})}),e.jsx(ve,{className:"hidden",children:s?"Update the details of the existing account.":"Fill in the details to create a new account."})]}),e.jsxs("div",{children:[e.jsxs(H,{htmlFor:"accountName",children:["Account Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(Q,{id:"accountName",value:f,onChange:l=>g(l.target.value),placeholder:"e.g., Main Bank Account",className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"accountNumber",children:"Account Number"}),e.jsx(Q,{id:"accountNumber",value:N,onChange:l=>h(l.target.value),placeholder:"e.g., 1010",className:"mt-1",disabled:s}),s&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Account number cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsxs(H,{htmlFor:"accountType",children:["Account Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{onValueChange:l=>{l!==u&&(m(l),S(""))},value:u,required:!0,children:[e.jsx(ae,{id:"accountType",className:"w-full mt-1",children:e.jsx(re,{placeholder:"Select account type",value:u})}),e.jsx(se,{children:jt.map(l=>e.jsx(X,{value:l,children:l},l))})]})]}),e.jsxs("div",{children:[e.jsxs(H,{htmlFor:"accountSubtype",children:["Account Sub-Type ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(te,{onValueChange:l=>{l!==u&&(m(l),initialRender.current||(console.log("onValueChange: Resetting accountSubtype (not initial render)"),S("")))},value:u,required:!0,children:[e.jsx(ae,{id:"accountSubtype",className:"w-full mt-1",children:e.jsx(re,{placeholder:"Select account sub-type",value:k})}),e.jsx(se,{children:(b=Te[u])==null?void 0:b.map(l=>(console.log("Account Subtype Select Item:",{accountType:u,subtype:l,currentAccountSubtype:k}),e.jsx(X,{value:l,children:l},l)))})]})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"subAccountOf",children:"Sub-Account of"}),e.jsxs(te,{onValueChange:w,value:B,children:[e.jsx(ae,{id:"subAccountOf",className:"w-full mt-1",children:e.jsx(re,{placeholder:"Select parent account"})}),e.jsxs(se,{children:[e.jsx(X,{value:M,children:"None"}),t.filter(l=>l.accNum!==L&&l.accType===u).map(l=>e.jsxs(X,{value:l.accNum,children:[l.accName," (",l.accNum,")"]},l.accNum))]})]},u)]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"openingBalance",children:"Opening Balance"}),e.jsx(Q,{id:"openingBalance",type:"number",value:y,onChange:l=>p(l.target.value),placeholder:"0.00",className:"mt-1",disabled:s}),s&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(H,{htmlFor:"openingBalanceDate",children:"Opening Balance As of Date"}),e.jsx("div",{children:e.jsx(rt,{date:O,setDate:T,className:"mt-1 w-full",disabled:s})}),s&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance date cannot be changed after creation."})]}),e.jsxs(Ke,{className:"pt-6",children:[e.jsx(Ve,{asChild:!0,children:e.jsx(D,{variant:"outline",onClick:x,children:"Cancel"})}),!s&&e.jsxs(D,{type:"button",onClick:l=>n(l,!1),variant:"secondary",children:[e.jsx(pe,{size:18,className:"mr-2"})," Save & New"]}),e.jsxs(D,{type:"submit",children:[e.jsx(pe,{size:18,className:"mr-2"})," ",s?"Update Account":"Save & Close"]})]})]})},kt=({result:t,onBack:o})=>{if(!t)return null;const{accountName:x,statementEndingDate:d,endingBalance:s,clearedBalance:r,clearedPayments:j,clearedDeposits:f,beginningBalance:g,reconciledTransactions:N}=t,h=s-r,u=()=>{window.print()};return e.jsxs("div",{className:"p-4 bg-white dark:bg-gray-800 rounded-lg shadow-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 print:hidden",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"Reconciliation Report"}),e.jsxs("div",{children:[e.jsx(D,{onClick:o,variant:"outline",className:"mr-2",children:"Back"}),e.jsx(D,{onClick:u,variant:"outline",children:"Print"})]})]}),e.jsx("div",{className:"text-center mb-4 hidden print:block",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"Reconciliation Report"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Account"}),e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:x})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Statement Ending Date"}),e.jsx("p",{className:"font-semibold text-gray-800 dark:text-gray-200",children:d})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2",children:[e.jsx("p",{children:"Beginning Balance"}),e.jsx("p",{className:"text-right",children:g.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx("p",{children:"Cleared Deposits and Other Credits"}),e.jsx("p",{className:"text-right",children:f.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx("p",{children:"Cleared Payments and Other Debits"}),e.jsx("p",{className:"text-right",children:j.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx("p",{className:"font-bold",children:"Cleared Balance"}),e.jsx("p",{className:"text-right font-bold",children:r.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx("p",{children:"Statement Ending Balance"}),e.jsx("p",{className:"text-right",children:s.toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx("p",{className:"font-bold text-lg",children:"Difference"}),e.jsx("p",{className:`text-right font-bold text-lg ${h===0?"text-green-500":"text-red-500"}`,children:h.toLocaleString("en-US",{style:"currency",currency:"USD"})})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200",children:"Cleared Transactions"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[e.jsx("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Date"}),e.jsx("th",{scope:"col",className:"px-6 py-3",children:"Description"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Debit"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right",children:"Credit"})]})}),e.jsx("tbody",{children:N.map((m,k)=>e.jsxs("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:m.date}),e.jsx("td",{className:"px-6 py-4",children:m.description}),e.jsx("td",{className:"px-6 py-4 text-right",children:m.debit>0?m.debit.toLocaleString("en-US",{style:"currency",currency:"USD"}):""}),e.jsx("td",{className:"px-6 py-4 text-right",children:m.credit>0?m.credit.toLocaleString("en-US",{style:"currency",currency:"USD"}):""})]},k))})]})})]})]})},vt=[{date:"2023-01-01",description:"Opening Balance",debit:5e3,credit:0,balance:5e3},{date:"2023-01-05",description:"Sales Revenue",debit:0,credit:2e3,balance:7e3},{date:"2023-01-10",description:"Office Supplies",debit:500,credit:0,balance:6500},{date:"2023-01-15",description:"Customer Payment",debit:0,credit:1e3,balance:7500},{date:"2023-01-20",description:"Utility Bill",debit:200,credit:0,balance:7300}],St=({account:t,onBack:o})=>{const[x,d]=c.useState(!1),[s,r]=c.useState(""),[j,f]=c.useState(""),[g,N]=c.useState(!1),[h,u]=c.useState([]),[m,k]=c.useState(""),[S,B]=c.useState(""),[w,y]=c.useState(null);if(w)return e.jsx(kt,{result:w,onBack:()=>y(null)});const p=t?vt.filter(n=>(n.description.includes(t.accName)||n.description.includes("Balance"))&&(!m||new Date(n.date)>=new Date(m))&&(!S||new Date(n.date)<=new Date(S))):[],O=p.length>0?p[0].balance:0,T=p.filter((n,b)=>b!==0&&h.includes(b)).reduce((n,b)=>n+b.debit,0),L=p.filter((n,b)=>b!==0&&h.includes(b)).reduce((n,b)=>n+b.credit,0),R=O-T+L,P=Number(s)-R;return t?g?e.jsxs("div",{className:"space-y-4 p-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(D,{variant:"outline",onClick:()=>N(!1),children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Back"]}),e.jsxs("h2",{className:"text-xl font-bold",children:["Reconcile ",t.accName]})]}),e.jsxs("div",{className:"grid grid-cols-8 gap-[2px] mb-2 items-center",children:[e.jsxs("div",{className:"col-span-2 bg-muted/30 dark:bg-dark-muted/30 p-2 rounded h-[90px] min-h-[90px] flex flex-col justify-center border border-blue-500 shadow-md shadow-blue-300/50",children:[e.jsx("h3",{className:"text-base font-semibold mb-1",children:"Ending Balance"}),e.jsx("p",{className:"font-bold text-base",children:Number(s).toLocaleString("en-US",{minimumFractionDigits:2})})]}),e.jsx("div",{className:"col-span-1 flex items-center justify-center text-2xl font-bold h-[90px] min-h-[90px]",children:"-"}),e.jsxs("div",{className:"col-span-2 bg-muted/30 dark:bg-dark-muted/30 p-2 rounded h-[90px] min-h-[90px] flex flex-col justify-center border border-blue-500 shadow-md shadow-blue-300/50",children:[e.jsx("h3",{className:"text-base font-semibold mb-1",children:"Cleared Balance"}),e.jsx("p",{className:"font-bold text-base",children:R.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsxs("p",{className:"text-xs italic",children:["Begin. Balance (",O,") - Payments (",T,") + Deposits (",L,")"]})]}),e.jsx("div",{className:"col-span-1 flex items-center justify-center text-2xl font-bold h-[90px] min-h-[90px]",children:"="}),e.jsxs("div",{className:"col-span-2 bg-muted/30 dark:bg-dark-muted/30 p-2 rounded h-[90px] min-h-[90px] flex flex-col justify-center border border-blue-500 shadow-md shadow-blue-300/50",title:"There is a difference. Please select transactions to reconcile.",children:[e.jsx("h3",{className:"text-base font-semibold mb-1",children:"Difference"}),e.jsx("p",{className:"font-bold text-base",children:P.toLocaleString("en-US",{minimumFractionDigits:2})}),P===0?e.jsx("p",{className:"text-green-600 font-semibold mt-1 text-xs",children:"Account reconciled!"}):e.jsx("p",{className:"text-red-600 font-semibold mt-1 text-xs"})]})]}),e.jsxs("div",{className:"bg-card dark:bg-dark-card p-2 rounded shadow-sm",children:[e.jsx("h3",{className:"text-base font-semibold mb-2",children:"Unreconciled Transactions"}),e.jsxs("table",{className:"w-full min-w-[600px] text-xs text-left text-foreground dark:text-dark-foreground border",children:[e.jsx("thead",{className:"bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-1",children:"Select"}),e.jsx("th",{className:"px-2 py-1",children:"Date"}),e.jsx("th",{className:"px-2 py-1",children:"Description"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Debit"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Credit"}),e.jsx("th",{className:"px-2 py-1 text-right",children:"Balance"})]})}),e.jsx("tbody",{children:p.map((n,b)=>b===0?null:e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"px-2 py-1 text-center",children:e.jsx("input",{type:"checkbox",checked:h.includes(b),onChange:l=>{l.target.checked?u([...h,b]):u(h.filter(V=>V!==b))}})}),e.jsx("td",{className:"px-2 py-1",children:n.date}),e.jsx("td",{className:"px-2 py-1",children:n.description}),e.jsx("td",{className:"px-2 py-1 text-right",children:n.debit.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{className:"px-2 py-1 text-right",children:n.credit.toLocaleString("en-US",{minimumFractionDigits:2})}),e.jsx("td",{className:"px-2 py-1 text-right",children:n.balance.toLocaleString("en-US",{minimumFractionDigits:2})})]},b))})]}),e.jsx(D,{variant:"primary",className:"mt-2",disabled:P!==0,onClick:()=>{const n={accountName:t.accName,statementEndingDate:j,endingBalance:Number(s),clearedBalance:R,clearedPayments:T,clearedDeposits:L,beginningBalance:O,reconciledTransactions:h.map(b=>p[b])};y(n),N(!1)},children:"Finish Reconciliation"})]})]}):e.jsxs("div",{className:"space-y-6 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs(D,{variant:"outline",onClick:o,className:"bg-white text-blue-700 border border-blue-500 hover:bg-blue-50",children:[e.jsx(be,{className:"mr-2 h-4 w-4"})," Chart of Accounts"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:["Ledger: ",t.accName," (",t.accNum,")"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 bg-muted/50 dark:bg-dark-muted/50 p-2 rounded-md mb-2 items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Account Type:"}),e.jsx("p",{className:"font-medium",children:t.accType})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Account Sub-Type:"}),e.jsx("p",{className:"font-medium",children:t.accSubtype})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Current Balance:"}),e.jsx("p",{className:"font-bold text-lg",children:t.balanceFormatted})]}),e.jsx(D,{variant:"primary",className:"bg-gradient-to-r from-blue-500 to-blue-700 text-white font-semibold px-5 py-1 rounded shadow hover:from-blue-600 hover:to-blue-800 transition ml-4",onClick:()=>d(!0),children:"Reconcile"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2 items-center bg-muted/30 dark:bg-dark-muted/30 p-2 rounded shadow-sm",children:[e.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:m,onChange:n=>k(n.target.value),className:"px-2 py-1 border rounded text-xs"})]}),e.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:S,onChange:n=>B(n.target.value),className:"px-2 py-1 border rounded text-xs"})]})]}),x?e.jsxs("div",{className:"mb-4 p-2 border rounded-md bg-muted/30 dark:bg-dark-muted/30 shadow",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Reconcile Account"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-muted-foreground mb-1",children:"Account Name"}),e.jsx("input",{type:"text",value:t.accName,disabled:!0,className:"w-full px-3 py-2 border rounded bg-muted/50 dark:bg-dark-muted/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-muted-foreground mb-1",children:"Beginning Balance"}),e.jsx("input",{type:"text",value:O.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2}),disabled:!0,className:"w-full px-3 py-2 border rounded bg-muted/50 dark:bg-dark-muted/50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-muted-foreground mb-1",children:"Statement Ending Balance"}),e.jsx("input",{type:"number",value:s,onChange:n=>r(n.target.value),placeholder:"Enter ending balance",className:"w-full px-3 py-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-muted-foreground mb-1",children:"Statement Ending Date"}),e.jsx("input",{type:"date",value:j,onChange:n=>f(n.target.value),className:"w-full px-3 py-2 border rounded"})]})]}),e.jsx(D,{variant:"primary",className:"bg-gradient-to-r from-green-500 to-green-700 text-white font-semibold px-6 py-2 rounded shadow hover:from-green-600 hover:to-green-800 transition",onClick:()=>{d(!1),N(!0)},children:"Start Reconciliation"}),e.jsx(D,{variant:"outline",className:"ml-2",onClick:()=>{d(!1),r(""),f(""),u([])},children:"Cancel"})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-2 overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",style:{minHeight:"70vh",maxHeight:"80vh",overflowY:"auto"},children:[e.jsx("h3",{className:"text-xl font-semibold p-2 bg-card dark:bg-dark-card border-b border-border dark:border-dark-border",children:"Transactions"}),e.jsxs("table",{className:"w-full min-w-[700px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-2 py-1",children:"Date"}),e.jsx("th",{scope:"col",className:"px-2 py-1",children:"Description"}),e.jsx("th",{scope:"col",className:"px-2 py-1",children:"Transaction Type"}),e.jsx("th",{scope:"col",className:"px-2 py-1 text-right",children:"Debit"}),e.jsx("th",{scope:"col",className:"px-2 py-1 text-right",children:"Credit"}),e.jsx("th",{scope:"col",className:"px-2 py-1 text-right",children:"Balance"})]})}),e.jsx("tbody",{children:p.length>0?p.map((n,b)=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-2 py-1",children:n.date}),e.jsx("td",{className:"px-2 py-1",children:n.description}),e.jsx("td",{className:"px-2 py-1",children:n.debit>0&&n.credit===0?"Payment":n.credit>0&&n.debit===0?"Deposit":"Other"}),e.jsx("td",{className:"px-2 py-1 text-right",children:n.debit.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"px-2 py-1 text-right",children:n.credit.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),e.jsx("td",{className:"px-2 py-1 text-right font-semibold",children:n.balance.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})})]},b)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-4 text-muted-foreground",children:"No transactions found for this account."})})})]})]})})]}):e.jsx("div",{className:"p-4 text-center text-muted-foreground",children:"Select an account to view its ledger."})},ge=[{sl:1,id:"acc-1001",accNum:"1001",accName:"Cash on Hand",accType:"Asset",accSubtype:"Current Assets",balance:5e3,openingBalance:5e3,openingBalanceDate:"2023-01-01",subAccountOf:null,isHeader:!1},{sl:2,id:"acc-1002",accNum:"1002",accName:"Accounts Receivable",accType:"Asset",accSubtype:"Current Assets",balance:12500,openingBalance:12500,openingBalanceDate:"2023-01-01",subAccountOf:null,isHeader:!1},{sl:3,id:"acc-2001",accNum:"2001",accName:"Accounts Payable",accType:"Liability",accSubtype:"Current Liabilities",balance:7200,openingBalance:7200,openingBalanceDate:"2023-01-01",subAccountOf:null,isHeader:!1},{sl:4,id:"acc-4001",accName:"Sales Revenue",accType:"Income",accSubtype:"Operating Income",balance:25e3,openingBalance:25e3,openingBalanceDate:"2023-01-01",subAccountOf:null,isHeader:!1},{sl:5,id:"acc-1003",accNum:"1003",accName:"Petty Cash",accType:"Asset",accSubtype:"Current Assets",balance:500,openingBalance:500,openingBalanceDate:"2023-01-01",subAccountOf:"1001",isHeader:!1},{sl:6,id:"acc-5001",accNum:"5001",accName:"Office Expenses",accType:"Expense",accSubtype:"Operating Expenses",balance:1200,openingBalance:1200,openingBalanceDate:"2023-01-01",subAccountOf:null,isHeader:!1},{sl:7,id:"acc-1000",accNum:"1000",accName:"Current Assets (Header)",accType:"Asset",accSubtype:"Current Assets",balance:0,openingBalance:0,openingBalanceDate:null,subAccountOf:null,isHeader:!0},{sl:8,id:"acc-1004",accNum:"1004",accName:"Bank Account A",accType:"Asset",accSubtype:"Current Assets",balance:1e4,openingBalance:1e4,openingBalanceDate:"2023-01-01",subAccountOf:"1000",isHeader:!1},{sl:9,id:"acc-1005",accNum:"1005",accName:"Bank Account B",accType:"Asset",accSubtype:"Current Assets",balance:7e3,openingBalance:7e3,openingBalanceDate:"2023-01-01",subAccountOf:"1000",isHeader:!1}],Y=t=>({...t,balanceFormatted:(t.balance||0).toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),accSubtype:t.accSubtype||"N/A"}),K=({children:t,columnKey:o,sortConfig:x,requestSort:d,isTextRight:s=!1,className:r=""})=>{const j=x&&x.key===o,f=j?x.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${s?"text-right":"text-left"} ${r}`,onClick:()=>d(o),children:e.jsxs("div",{className:`flex items-center ${s?"justify-end":"justify-start"}`,children:[!s&&t,e.jsx("span",{className:`mx-1 ${s?"mr-0 ml-1":"ml-0 mr-1"}`,children:j?f==="ascending"?"▲":"▼":e.jsx(xt,{size:14,className:"opacity-40"})}),s&&t]})})},Mt=()=>{const{toast:t}=je(),[o,x]=c.useState(()=>ge.map(Y)),[d,s]=c.useState(""),[r,j]=c.useState({key:"sl",direction:"ascending"}),[f,g]=c.useState(!1),[N,h]=c.useState(null),[u,m]=c.useState(!1),[k,S]=c.useState(null),[B,w]=c.useState(null),[y,p]=c.useState({}),O=(a,i)=>{let C=i.filter(F=>F.subAccountOf===a),A=[...C];return C.forEach(F=>{A=A.concat(O(F.accNum,i))}),A},T=(a,i)=>{const A=O(a.accNum,i).reduce((F,G)=>F+(G.balance||0),0);return(a.balance||0)+A},L=a=>{p(i=>({...i,[a]:!i[a]}))};c.useEffect(()=>{const a=localStorage.getItem("chartOfAccounts");a?x(JSON.parse(a).map(Y)):localStorage.setItem("chartOfAccounts",JSON.stringify(ge))},[]);const R=a=>{localStorage.setItem("chartOfAccounts",JSON.stringify(a.map(({balanceFormatted:i,...C})=>C)))},[P,n]=c.useState(null),b=(a=null,i="add_new")=>{console.log("handleOpenModal called with:",{account:a,type:i}),i==="edit"?(h(a),n(null),g(!0)):i==="add_child_account"?(h(null),n(a),g(!0)):(h(null),n(null),g(!0))},l=()=>{g(!1),h(null)},V=(a,i)=>{x(C=>{let A;if(i)A=C.map(F=>F.id===a.id?Y({...F,...a,balance:a.openingBalance}):F);else{const F=C.length>0?Math.max(...C.map(v=>v.sl))+1:1,G=Y({...a,sl:F,balance:a.openingBalance});A=[...C,G]}return R(A),A})},Z=a=>{const i=o.find(C=>C.id===a);if(i){const C=o.some(A=>A.subAccountOf===i.accNum);if(i.isHeader&&C){t({title:"Deletion Blocked",description:`Cannot delete header account "${i.accName}" because it has sub-accounts. Please delete sub-accounts first.`,variant:"destructive"});return}S(i),m(!0)}},Fe=()=>{if(k){const a=o.filter(i=>i.id!==k.id);x(a),R(a),t({title:"Account Deleted",description:`${k.accName} has been deleted.`,variant:"destructive"}),m(!1),S(null)}},Le=()=>{t({title:"Import from Excel",description:"This feature will be available soon.",duration:3e3})},Ee=a=>s(a.target.value),$=a=>{let i="ascending";r&&r.key===a&&r.direction==="ascending"&&(i="descending"),j({key:a,direction:i})},de=c.useMemo(()=>{let a=[...o];if(d){const v=d.toLowerCase();a=a.filter(U=>Object.values(U).some(z=>String(z).toLowerCase().includes(v)))}const i=v=>r?[...v].sort((z,q)=>{let I=z[r.key],E=q[r.key];return["balance","sl","openingBalance"].includes(r.key)?(I=parseFloat(I)||0,E=parseFloat(E)||0):typeof I=="string"&&(I=I.toLowerCase(),E=E.toLowerCase()),I<E?r.direction==="ascending"?-1:1:I>E?r.direction==="ascending"?1:-1:0}):v,C=new Map(a.map(v=>[v.accNum,{...v,children:[]}]));let A=[];C.forEach(v=>{if(!v.subAccountOf||!C.has(v.subAccountOf))A.push(v);else{const U=C.get(v.subAccountOf);U?U.children.push(v):A.push(v)}}),C.forEach(v=>{v.children=i(v.children)}),A=i(A);const F=(v,U=0,z="")=>{let q=[],I=1;return v.forEach(E=>{const J=y[E.accNum],ee=E.children.length>0;let oe=E.balance;ee&&!J&&(oe=T(E,o));const ie=z?`${z}.${I}`:`${I}`;q.push({...E,level:U,isExpanded:J,hasChildren:ee,displaySl:ie,displayBalanceFormatted:(oe||0).toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),J&&ee&&(q=q.concat(F(E.children,U+1,ie))),I++}),q};return F(A)},[d,r,o,y]);return e.jsx("div",{className:"space-y-6 p-1",children:B?e.jsx(St,{account:B,onBack:()=>w(null)}):e.jsxs(nt,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(ct,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(lt,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(ot,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Chart of Accounts"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(ze,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(he,{size:20,className:"mr-2"})," Add Account"]})}),e.jsxs(Me,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(xe,{onClick:()=>b(null,"add_new"),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Add New"}),e.jsx(xe,{onClick:Le,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Import from Excel"})]})]})})]})}),e.jsxs(dt,{className:"p-4 md:p-6",children:[f&&e.jsx(Ge,{open:f,onOpenChange:g,children:e.jsxs(Je,{className:"sm:max-w-[550px] bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(Ne,{children:[e.jsx(ke,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:N?"Edit Account":"Add New Account"}),e.jsx(ve,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:N?"Update the account details.":"Fill in the details to create a new account."})]}),e.jsx(Nt,{existingAccounts:o,onSave:V,onCancel:l,initialData:N,isEditMode:!!N,initialSubAccountData:P})]})}),e.jsx(Xe,{open:u,onOpenChange:m,children:e.jsxs(Ye,{children:[e.jsxs(Qe,{children:[e.jsx(We,{children:"Are you absolutely sure?"}),e.jsxs(Ze,{children:['This action cannot be undone. This will permanently delete the account "',k==null?void 0:k.accName,'".']})]}),e.jsxs(et,{children:[e.jsx(tt,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(at,{onClick:Fe,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete account"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(Q,{type:"text",placeholder:"Search accounts (Sl No, Name, Type...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:d,onChange:Ee}),e.jsxs(D,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>t({title:"Search Updated",description:`Displaying results for "${d}"`}),children:[e.jsx(it,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[800px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(K,{columnKey:"sl",sortConfig:r,requestSort:$,className:"w-16",children:"Sl"}),e.jsx(K,{columnKey:"accNum",sortConfig:r,requestSort:$,children:"Acc. No."}),e.jsx(K,{columnKey:"accName",sortConfig:r,requestSort:$,className:"min-w-[250px]",children:"Account Name"}),e.jsx(K,{columnKey:"accType",sortConfig:r,requestSort:$,children:"Type"}),e.jsx(K,{columnKey:"accSubtype",sortConfig:r,requestSort:$,children:"Sub-Type"}),e.jsx(K,{columnKey:"balance",sortConfig:r,requestSort:$,isTextRight:!0,children:"Balance"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[de.map(a=>e.jsx(ye.Fragment,{children:e.jsxs("tr",{className:`border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150 ${a.isHeader?"bg-blue-50 dark:bg-blue-950 font-semibold text-base text-blue-800 dark:text-blue-200":"bg-card dark:bg-dark-card text-sm text-foreground dark:text-dark-foreground"}`,children:[e.jsxs("td",{className:"px-4 py-3",style:{paddingLeft:`${16+a.level*20}px`},children:[a.hasChildren&&e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 mr-1",onClick:()=>L(a.accNum),children:a.isExpanded?e.jsx(_e,{size:16}):e.jsx(He,{size:16})}),a.displaySl]}),e.jsx("td",{className:"px-4 py-3 text-xs font-mono",children:a.accNum}),e.jsxs("td",{className:"px-4 py-3 font-medium text-secondary dark:text-dark-secondary hover:underline cursor-pointer",onClick:()=>w(a),style:{paddingLeft:`${16+a.level*20}px`},children:[a.accName,e.jsx(D,{variant:"ghost",size:"icon",className:"h-6 w-6 ml-2 text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300",onClick:i=>{i.stopPropagation(),b(a,"add_child_account")},children:e.jsx(he,{size:16})})]}),e.jsx("td",{className:"px-4 py-3",children:a.accType}),e.jsx("td",{className:"px-4 py-3",children:a.accSubtype}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold hover:underline cursor-pointer text-primary dark:text-dark-primary",onClick:()=>w(a),children:a.displayBalanceFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(D,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>b(o.find(i=>i.id===a.id),"edit"),children:e.jsx(ut,{size:16})}),e.jsx(D,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>Z(a.id),children:e.jsx(mt,{size:16})})]})]})},a.id)),de.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:d?`No accounts found for "${d}".`:"No accounts found. Get started by adding an account!"})})]})]})})]})]})})};export{Mt as default};
