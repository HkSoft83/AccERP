import{r as n,j as e,B as v}from"./index-4ee0f0da.js";import{C as O,a as R,b as L,c as P}from"./card-0b571230.js";import{S as M,a as z,b as J,c as H,d as U}from"./select-5d8a578c.js";import{D as w,f as V}from"./date-picker-2abee23a.js";import{I as Y}from"./input-8ed76811.js";import{T as $,a as A,b,c as m,d as X,e as c}from"./table-655433fa.js";import{U as Z}from"./user-bee0cc55.js";import{P as q}from"./printer-32ae61b2.js";import{S as G}from"./search-8c5c897c.js";import{p,F as K}from"./parseISO-76afde5b.js";import"./check-6bd3e78d.js";const le=()=>{const[g,B]=n.useState([]),[l,j]=n.useState(""),[N,T]=n.useState([]),[i,F]=n.useState([]),[x,k]=n.useState(null),[h,S]=n.useState(null),[f,C]=n.useState("");n.useEffect(()=>{const r=(JSON.parse(localStorage.getItem("customers"))||[{id:"cust-001",name:"Client Omega Corp.",openingBalance:2800,openingBalanceDate:"2025-01-01"},{id:"cust-002",name:"Customer Zeta Ltd.",openingBalance:0,openingBalanceDate:"2025-01-01"}]).map(s=>({id:s.customerNumber||s.id,name:s.name,openingBalance:parseFloat(s.openingBalance)||0,openingBalanceDate:s.openingBalanceDate?p(s.openingBalanceDate):new Date(new Date().getFullYear(),0,1)}));B(r),r.length>0&&j(r[0].id)},[]),n.useEffect(()=>{if(!l)return;const t=JSON.parse(localStorage.getItem("salesInvoices"))||[],r=JSON.parse(localStorage.getItem("receipts"))||[],s=JSON.parse(localStorage.getItem("salesReturns"))||[],y=JSON.parse(localStorage.getItem("creditNotes"))||[],o=[];t.filter(a=>a.customerId===l).forEach(a=>{var u;return o.push({date:p(a.invoiceDate),type:"Sales Invoice",ref:a.invoiceNumber,narration:`Invoice for ${((u=a.lineItems)==null?void 0:u.length)||0} items`,debit:parseFloat(a.grandTotal)||0,credit:0})}),r.filter(a=>a.receivedFrom===l).forEach(a=>o.push({date:p(a.date),type:"Receipt",ref:a.receiptNumber,narration:a.narration||"Payment received",debit:0,credit:parseFloat(a.amount)||0})),s.filter(a=>a.customerId===l).forEach(a=>{var u;return o.push({date:p(a.returnDate),type:"Sales Return",ref:a.returnNumber,narration:`Return of ${((u=a.lineItems)==null?void 0:u.length)||0} items`,debit:0,credit:parseFloat(a.grandTotal)||0})}),y.filter(a=>a.debitAccount===l).forEach(a=>o.push({date:p(a.date),type:"Credit Note",ref:a.creditNoteNumber,narration:a.narration||"Credit issued",debit:0,credit:parseFloat(a.amount)||0})),T(o)},[l]);const d=n.useMemo(()=>g.find(t=>t.id===l),[g,l]),D=n.useMemo(()=>{if(!d)return[];let t=d.openingBalance;const r=d.openingBalanceDate||new Date(new Date().getFullYear(),0,1),s=[];return s.push({date:r,type:"Opening Balance",ref:"-",narration:"Opening Balance",debit:d.openingBalance>=0?d.openingBalance:0,credit:d.openingBalance<0?Math.abs(d.openingBalance):0,balance:t}),[...N].sort((o,a)=>o.date-a.date).forEach(o=>{t+=(o.debit||0)-(o.credit||0),s.push({...o,balance:t})}),s},[N,d]);n.useEffect(()=>{let t=D;if(x&&(t=t.filter(r=>r.date>=x)),h&&(t=t.filter(r=>r.date<=h)),f){const r=f.toLowerCase();t=t.filter(s=>s.type.toLowerCase().includes(r)||s.ref.toLowerCase().includes(r)||s.narration.toLowerCase().includes(r))}F(t)},[D,x,h,f]);const I=()=>window.print(),E=()=>{k(null),S(null),C("")};return e.jsx("div",{className:"space-y-6 p-4 md:p-6",children:e.jsxs(O,{className:"shadow-xl border-border dark:border-dark-border",children:[e.jsx(R,{className:"bg-muted/50 dark:bg-dark-muted/50 p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2",children:[e.jsxs(L,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(Z,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Customer Ledger"]}),e.jsxs(v,{onClick:I,variant:"outline",size:"sm",className:"self-start sm:self-center",children:[e.jsx(q,{size:16,className:"mr-2"})," Print"]})]})}),e.jsxs(P,{className:"p-4 md:p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"customerSelect",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"Select Customer"}),e.jsxs(M,{value:l,onValueChange:j,children:[e.jsx(z,{id:"customerSelect",children:e.jsx(J,{placeholder:"Choose a customer"})}),e.jsx(H,{children:g.map(t=>e.jsxs(U,{value:t.id,children:[t.name," (",t.id,")"]},t.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"startDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"From Date"}),e.jsx(w,{date:x,setDate:k,id:"startDate",placeholder:"Start Date"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{htmlFor:"endDate",className:"text-sm font-medium text-muted-foreground dark:text-dark-muted-foreground",children:"To Date"}),e.jsx(w,{date:h,setDate:S,id:"endDate",placeholder:"End Date"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 items-center pt-2",children:[e.jsxs("div",{className:"relative flex-grow w-full sm:w-auto",children:[e.jsx(G,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground dark:text-dark-muted-foreground"}),e.jsx(Y,{type:"search",placeholder:"Search transactions...",value:f,onChange:t=>C(t.target.value),className:"pl-8 w-full"})]}),e.jsxs(v,{onClick:E,variant:"outline",size:"sm",className:"w-full sm:w-auto",children:[e.jsx(K,{size:16,className:"mr-2"})," Clear Filters"]})]}),d&&e.jsxs("div",{className:"p-3 bg-primary/5 dark:bg-dark-primary/10 rounded-md border border-primary/20 dark:border-dark-primary/20",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:d.name}),e.jsxs("p",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground",children:["Customer ID: ",d.id]})]}),e.jsx("div",{className:"overflow-x-auto border border-border dark:border-dark-border rounded-lg",children:e.jsxs($,{children:[e.jsx(A,{className:"bg-muted dark:bg-dark-muted",children:e.jsxs(b,{children:[e.jsx(m,{className:"w-[100px]",children:"Date"}),e.jsx(m,{children:"Type / Ref#"}),e.jsx(m,{children:"Narration"}),e.jsx(m,{className:"text-right",children:"Debit"}),e.jsx(m,{className:"text-right",children:"Credit"}),e.jsx(m,{className:"text-right",children:"Balance"})]})}),e.jsx(X,{children:i.length>0?i.map((t,r)=>e.jsxs(b,{className:"hover:bg-muted/50 dark:hover:bg-dark-muted/50",children:[e.jsx(c,{children:V(t.date,"dd-MMM-yy")}),e.jsxs(c,{children:[e.jsx("div",{className:"font-medium",children:t.type}),e.jsx("div",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground",children:t.ref})]}),e.jsx(c,{children:t.narration}),e.jsx(c,{className:"text-right",children:(t.debit||0)>0?(t.debit||0).toFixed(2):"-"}),e.jsx(c,{className:"text-right",children:(t.credit||0)>0?(t.credit||0).toFixed(2):"-"}),e.jsx(c,{className:"text-right font-semibold",children:t.balance.toFixed(2)})]},r)):e.jsx(b,{children:e.jsx(c,{colSpan:6,className:"text-center h-24 text-muted-foreground dark:text-dark-muted-foreground",children:"No transactions found for this customer."})})})]})}),i.length>0&&e.jsxs("div",{className:"flex justify-end pt-2 text-sm font-semibold text-primary dark:text-dark-primary",children:["Final Balance: ",i[i.length-1].balance.toFixed(2),i[i.length-1].balance>=0?" (Receivable)":" (Payable)"]})]})]})})};export{le as default};
