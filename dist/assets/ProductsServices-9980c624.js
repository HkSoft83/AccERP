import{c as ze,g as Ce,r as d,j as e,B as N,A as Ee,m as ge}from"./index-6ef9a250.js";import{I as l}from"./input-6aebf58f.js";import{D as Oe,a as We,b as qe,c as ye}from"./dropdown-menu-8cb8afd1.js";import{D as Fe,a as we,b as Pe,c as $e,d as Le,e as Ke,f as Re}from"./dialog-4ddb2f0f.js";import{A as He,a as Je,b as Ge,c as Ye,d as Me,e as Xe,f as Ze,g as _e}from"./alert-dialog-0c4287f2.js";import{L as c}from"./label-2748d824.js";import{S as et}from"./switch-402f5d9a.js";import{S as be,a as ve,b as fe,c as je,d as Ne}from"./select-5a7be211.js";import{P as ce}from"./plus-circle-3765d736.js";import{T as le}from"./trash-2-d896a3b4.js";import{S as tt}from"./save-6a252b25.js";import{C as rt,a as at,b as st,c as ot}from"./card-19b38789.js";import{F as dt}from"./file-down-9dcf6ff6.js";import{S as nt}from"./search-a497960d.js";import{P as it}from"./pen-square-0e7179e0.js";import{A as ct}from"./arrow-up-down-9a395eed.js";import"./index-3b8b6dae.js";import"./check-0fdc0954.js";const me=ze("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),ke=[{value:"Stock",label:"Stock",description:"Products you buy and/or sell and that you track quantities of."},{value:"Non-stock",label:"Non-stock",description:"Products you buy and/or sell but don’t need to (or can’t) track quantities of, for example, nuts and bolts used in an installation."},{value:"Service",label:"Service",description:"Services that you provide to customers."},{value:"Combo",label:"Combo",description:"A collection of products and/or services that you sell together, for example, a gift basket of fruit, cheese, and wine."}],lt=({onSave:u,onCancel:g,initialData:a,isEditMode:n,allProducts:v})=>{var he;const{toast:s}=Ce(),[o,F]=d.useState("Stock"),[S,w]=d.useState(""),[Q,z]=d.useState(""),[P,k]=d.useState(""),[U,I]=d.useState(""),[T,E]=d.useState(""),[O,W]=d.useState(""),[B,q]=d.useState("Extra Field 1"),[$,f]=d.useState(""),[D,r]=d.useState("Extra Field 2"),[x,y]=d.useState(""),[m,p]=d.useState(""),[A,L]=d.useState(""),[ue,M]=d.useState(""),[xe,X]=d.useState(""),[K,Z]=d.useState(!1),[R,_]=d.useState(""),[H,J]=d.useState([]),[ee,te]=d.useState(""),[re,ae]=d.useState(1),[b,V]=d.useState([{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),[G,se]=d.useState(""),[oe,de]=d.useState(1),[ne,pe]=d.useState(null);d.useEffect(()=>{var t,i,j,h;n&&a?(F(a.productType||"Stock"),w(a.name||""),z(a.code||a.id||""),k(a.description||""),I(a.batchNo||""),E(a.manufacturingDate||""),W(a.expiryDate||""),q(a.extraField1Name||"Extra Field 1"),f(a.extraField1Value||""),r(a.extraField2Name||"Extra Field 2"),y(a.extraField2Value||""),p(a.category||""),L(((t=a.costingPrice)==null?void 0:t.toString())||""),M(((i=a.salesPrice)==null?void 0:i.toString())||""),X(((j=a.openingQuantity)==null?void 0:j.toString())||""),Z(a.hasWarranty||!1),_(((h=a.warrantyDays)==null?void 0:h.toString())||""),V(a.units&&a.units.length>0?a.units:[{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),pe(a.id||a.code),J(a.comboItems||[])):De()},[a,n]);const De=()=>{F("Stock"),w(""),z(""),k(""),I(""),E(""),W(""),q("Extra Field 1"),f(""),r("Extra Field 2"),y(""),p(""),L(""),M(""),X(""),Z(!1),_(""),V([{id:Date.now(),name:"pcs",factor:1,isBase:!0}]),se(""),de(1),pe(null),J([]),te(""),ae(1)},Ae=()=>{if(!G.trim()||oe<=0){s({title:"Invalid Unit",description:"Please provide a valid unit name and factor.",variant:"destructive"});return}if(b.find(t=>t.name.toLowerCase()===G.trim().toLowerCase())){s({title:"Duplicate Unit",description:"This unit name already exists.",variant:"destructive"});return}V([...b,{id:Date.now(),name:G.trim(),factor:parseFloat(oe),isBase:b.length===0}]),se(""),de(1)},Ue=t=>{if(b.length===1){s({title:"Cannot Remove",description:"At least one unit must be defined.",variant:"destructive"});return}const i=b.find(j=>j.id===t);if(i&&i.isBase&&b.length>1){s({title:"Cannot Remove Base Unit",description:"Please set another unit as base before removing.",variant:"destructive"});return}V(b.filter(j=>j.id!==t))},Ie=t=>{V(b.map(i=>({...i,isBase:i.id===t})))},Te=(t,i)=>{V(j=>j.map(h=>h.id===t?{...h,name:i}:h))},ie=()=>{const t=b.find(i=>i.isBase);return t?t.name:"N/A"},Be=()=>{if(!ee){s({title:"Validation Error",description:"Please select a product/service to add to the combo.",variant:"destructive"});return}if(re<=0){s({title:"Validation Error",description:"Quantity must be a positive number.",variant:"destructive"});return}const t=v.find(i=>i.id===ee);t&&(J(i=>[...i,{...t,comboQuantity:re}]),te(""),ae(1))},Ve=t=>{J(i=>i.filter(j=>j.id!==t))},Qe=t=>{if(t.preventDefault(),!S.trim()){s({title:"Validation Error",description:"Product name is required.",variant:"destructive"});return}if(o!=="Service"&&o!=="Combo"&&b.filter(h=>h.isBase).length!==1){s({title:"Validation Error",description:"Exactly one unit must be set as the base unit.",variant:"destructive"});return}if(K&&(!R||parseInt(R)<=0)){s({title:"Validation Error",description:"Warranty days must be a positive number.",variant:"destructive"});return}if(o==="Combo"&&H.length===0){s({title:"Validation Error",description:"Combo products must contain at least one item.",variant:"destructive"});return}const i=b.find(h=>h.isBase),j={id:ne||`prod-${Date.now()}`,productType:o,name:S,code:Q||(ne?ne.split("-")[1]||String(Date.now()).slice(-4):`P${String(Date.now()).slice(-4)}`),description:P,batchNo:o!=="Combo"?U:"",manufacturingDate:o!=="Combo"?T:"",expiryDate:o!=="Combo"?O:"",extraField1Name:o!=="Combo"?B:"",extraField1Value:o!=="Combo"?$:"",extraField2Name:o!=="Combo"?D:"",extraField2Value:o!=="Combo"?x:"",batchNo:U,manufacturingDate:T,expiryDate:O,extraField1Name:B,extraField1Value:$,extraField2Name:D,extraField2Value:x,category:o==="Combo"?"Combo":m,costingPrice:o==="Combo"?0:parseFloat(A)||0,salesPrice:o==="Combo"?0:parseFloat(ue)||0,openingQuantity:o==="Service"||o==="Combo"?1/0:parseFloat(xe)||0,hasWarranty:K,warrantyDays:K?parseInt(R):0,units:o==="Service"||o==="Combo"?[]:b.map(h=>({...h,factor:parseFloat(h.factor)})),baseUnitName:o==="Service"||o==="Combo"?"N/A":i?i.name:"N/A",comboItems:o==="Combo"?H.map(h=>({id:h.id,name:h.name,comboQuantity:h.comboQuantity})):[],sl:n&&a?a.sl:void 0,location:n&&a?a.location:"Warehouse A"};u(j,n),s({title:`Product ${n?"Updated":"Added"}`,description:`${S} has been successfully ${n?"updated":"added"}.`,className:"bg-green-500 text-white dark:bg-green-600 dark:text-white"}),g()};return e.jsxs("form",{onSubmit:Qe,className:"space-y-6 p-1",children:[e.jsxs(Fe,{className:"hidden",children:[e.jsx(we,{children:n?"Edit Product/Service":"Add New Product/Service"}),e.jsx(Pe,{children:n?"Update the details of the existing product or service.":"Fill in the details to add a new product or service to your inventory."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productType",className:"font-semibold",children:["Product/Service Type ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(be,{onValueChange:F,value:o,disabled:n,children:[e.jsx(ve,{id:"productType",children:e.jsx(fe,{placeholder:"Select a product type",children:o?(he=ke.find(t=>t.value===o))==null?void 0:he.label:""})}),e.jsx(je,{children:ke.map(t=>e.jsxs(Ne,{value:t.value,children:[e.jsx("span",{className:"font-medium",children:t.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},t.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"productName",className:"font-semibold",children:["Product/Service Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(l,{id:"productName",value:S,onChange:t=>w(t.target.value),placeholder:"e.g., Premium Widget, Hourly Consulting",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"productCode",className:"font-semibold",children:"Product Code/SKU"}),e.jsx(l,{id:"productCode",value:Q,onChange:t=>z(t.target.value),placeholder:"Auto-generated if blank",disabled:n}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Product code cannot be changed after creation."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",className:"font-semibold",children:"Description"}),e.jsx(l,{id:"description",value:P,onChange:t=>k(t.target.value),placeholder:"Brief description of the product/service"})]}),o!=="Combo"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"batchNo",className:"font-semibold",children:"Batch No"}),e.jsx(l,{id:"batchNo",value:U,onChange:t=>I(t.target.value),placeholder:"e.g., BATCH-2023-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"manufacturingDate",className:"font-semibold",children:"Manufacturing Date"}),e.jsx(l,{id:"manufacturingDate",type:"date",value:T,onChange:t=>E(t.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"expiryDate",className:"font-semibold",children:"Expiry Date"}),e.jsx(l,{id:"expiryDate",type:"date",value:O,onChange:t=>W(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"extraField1Name",className:"font-semibold",children:"Extra Field 1 Name"}),e.jsx(l,{id:"extraField1Name",value:B,onChange:t=>q(t.target.value),placeholder:"e.g., Color"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"extraField1Value",className:"font-semibold",children:B}),e.jsx(l,{id:"extraField1Value",value:$,onChange:t=>f(t.target.value),placeholder:"Value for Extra Field 1"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"extraField2Name",className:"font-semibold",children:"Extra Field 2 Name"}),e.jsx(l,{id:"extraField2Name",value:D,onChange:t=>r(t.target.value),placeholder:"e.g., Size"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"extraField2Value",className:"font-semibold",children:D}),e.jsx(l,{id:"extraField2Value",value:x,onChange:t=>setExtraField22Value(t.target.value),placeholder:"Value for Extra Field 2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"category",className:"font-semibold",children:"Category"}),e.jsx(l,{id:"category",value:m,onChange:t=>p(t.target.value),placeholder:"e.g., Electronics, Services, Materials"})]})]}),o!=="Combo"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"costingPrice",className:"font-semibold",children:["Costing Price (per ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(l,{id:"costingPrice",type:"number",value:A,onChange:t=>L(t.target.value),placeholder:"0.00",min:"0",step:"0.01",disabled:n,className:n?"disabled:opacity-70 disabled:cursor-not-allowed":""}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Costing price cannot be changed after creation."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{htmlFor:"salesPrice",className:"font-semibold",children:["Default Sales Price (per ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(l,{id:"salesPrice",type:"number",value:ue,onChange:t=>M(t.target.value),placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 pt-2",children:[e.jsx(et,{id:"hasWarranty",checked:K,onCheckedChange:Z}),e.jsx(c,{htmlFor:"hasWarranty",className:"font-semibold",children:"Has Warranty"})]}),K&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsx(c,{htmlFor:"warrantyDays",className:"font-semibold",children:"Warranty Days"}),e.jsx(l,{id:"warrantyDays",type:"number",value:R,onChange:t=>_(t.target.value),placeholder:"e.g., 365"})]}),o==="Stock"&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(c,{htmlFor:"openingQuantity",className:"font-semibold",children:["Opening Quantity (in ",e.jsx("span",{className:"text-accent dark:text-dark-accent",children:ie()}),")"]}),e.jsx(l,{id:"openingQuantity",type:"number",value:xe,onChange:t=>X(t.target.value),placeholder:"0",min:"0",disabled:n,className:n?"disabled:opacity-70 disabled:cursor-not-allowed":""}),n&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening quantity cannot be changed after creation."})]}),(o==="Stock"||o==="Non-stock")&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border dark:border-dark-border mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:"Manage Units of Measure"}),e.jsxs("div",{className:"p-4 bg-muted/50 dark:bg-dark-muted/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"newUnitName",children:"New Unit Name"}),e.jsx(l,{id:"newUnitName",value:G,onChange:t=>se(t.target.value),placeholder:"e.g., Dozen, Box"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"newUnitFactor",children:"Factor (to Base Unit)"}),e.jsx(l,{id:"newUnitFactor",type:"number",value:oe,onChange:t=>de(t.target.value),placeholder:"e.g., 12",min:"0.001",step:"any"})]}),e.jsxs(N,{type:"button",onClick:Ae,className:"sm:self-end bg-secondary hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover text-secondary-foreground dark:text-dark-secondary-foreground",children:[e.jsx(ce,{size:18,className:"mr-2"})," Add Unit"]})]}),e.jsx(Ee,{children:b.length>0&&e.jsx(ge.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"space-y-2 pt-2",children:b.map(t=>e.jsxs(ge.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{type:"spring",stiffness:300,damping:30},className:"flex items-center justify-between p-2.5 bg-background dark:bg-dark-background rounded-md shadow-sm border border-border dark:border-dark-border",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>Ie(t.id),className:`mr-2 h-7 w-7 ${t.isBase?"text-yellow-500 dark:text-yellow-400":"text-muted-foreground dark:text-dark-muted-foreground"}`,children:e.jsx(me,{size:18,fill:t.isBase?"currentColor":"none"})}),t.isBase?e.jsx(l,{value:t.name,onChange:i=>Te(t.id,i.target.value),className:"w-24 h-8 text-sm"}):e.jsx("span",{className:"font-medium text-foreground dark:text-dark-foreground",children:t.name}),e.jsxs("span",{className:"text-sm text-muted-foreground dark:text-dark-muted-foreground ml-2",children:["(",t.factor," to Base)"]})]}),e.jsx(N,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ue(t.id),className:"text-destructive dark:text-red-400 hover:text-destructive/80 h-7 w-7",children:e.jsx(le,{size:16})})]},t.id))})}),e.jsxs("p",{className:"text-xs text-muted-foreground dark:text-dark-muted-foreground pt-1",children:["Click the star ",e.jsx(me,{size:12,className:"inline text-yellow-500"})," to set a unit as the base unit. All other unit factors are relative to this base unit."]})]})]}),o==="Combo"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border dark:border-dark-border mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-primary dark:text-dark-primary",children:"Combo Items"}),e.jsxs("div",{className:"p-4 bg-muted/50 dark:bg-dark-muted/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 items-end",children:[e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(c,{htmlFor:"comboProduct",children:"Select Product/Service"}),e.jsxs(be,{onValueChange:te,value:ee,children:[e.jsx(ve,{id:"comboProduct",children:e.jsx(fe,{placeholder:"Select a product/service"})}),e.jsx(je,{children:v.filter(t=>t.productType!=="Combo").map(t=>e.jsxs(Ne,{value:t.id,children:[t.name," (",t.productType,")"]},t.id))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"comboQuantity",children:"Quantity"}),e.jsx(l,{id:"comboQuantity",type:"number",value:re,onChange:t=>ae(parseInt(t.target.value)||1),min:"1"})]}),e.jsxs(N,{type:"button",onClick:Be,className:"sm:self-end bg-secondary hover:bg-secondary-hover dark:bg-dark-secondary dark:hover:bg-dark-secondary-hover text-secondary-foreground dark:text-dark-secondary-foreground",children:[e.jsx(ce,{size:18,className:"mr-2"})," Add Item"]})]}),H.length>0&&e.jsx("div",{className:"overflow-x-auto rounded-md border border-border dark:border-dark-border mt-4",children:e.jsxs("table",{className:"w-full text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2",children:"Product/Service Name"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-right",children:"Quantity"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:H.map(t=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0",children:[e.jsx("td",{className:"px-4 py-2",children:t.name}),e.jsx("td",{className:"px-4 py-2 text-right",children:t.comboQuantity}),e.jsx("td",{className:"px-4 py-2 text-center",children:e.jsx(N,{type:"button",variant:"ghost",size:"icon",onClick:()=>Ve(t.id),className:"text-destructive dark:text-red-400 hover:text-destructive/80 h-7 w-7",children:e.jsx(le,{size:16})})})]},t.id))})]})})]})]}),e.jsxs($e,{className:"pt-8",children:[e.jsx(Le,{asChild:!0,children:e.jsx(N,{type:"button",variant:"outline",onClick:g,children:"Cancel"})}),e.jsxs(N,{type:"submit",className:"bg-primary hover:bg-primary-hover dark:bg-dark-primary dark:hover:bg-dark-primary-hover text-primary-foreground dark:text-dark-primary-foreground",children:[e.jsx(tt,{size:18,className:"mr-2"})," ",n?"Update Product":"Save Product"]})]})]})},Se=[{sl:1,id:"PROD001",productType:"Stock",name:"Standard Widget",code:"PROD001",location:"Warehouse A",costingPrice:15.5,salesPrice:25,openingQuantity:150,units:[{id:1,name:"pcs",factor:1,isBase:!0}],baseUnitName:"pcs",openingQuantityDate:"2023-01-01",hasWarranty:!1,warrantyDays:0,category:"Widgets",description:"A standard quality widget."},{sl:2,id:"PROD002",productType:"Stock",name:"Premium Gadget",code:"PROD002",location:"Warehouse B",costingPrice:49.99,salesPrice:89.99,openingQuantity:75,units:[{id:1,name:"pcs",factor:1,isBase:!0},{id:2,name:"box",factor:5,isBase:!1}],baseUnitName:"pcs",openingQuantityDate:"2023-01-15",hasWarranty:!0,warrantyDays:365,category:"Gadgets",description:"A premium quality gadget with extra features."},{sl:3,id:"SERV001",productType:"Service",name:"Consulting Hour",code:"SERV001",location:"N/A",costingPrice:0,salesPrice:100,openingQuantity:1/0,units:[],baseUnitName:"N/A",openingQuantityDate:null,hasWarranty:!1,warrantyDays:0,category:"Services",description:"One hour of expert consulting."}],Y=u=>{var s;const g=((s=u.units)==null?void 0:s.find(o=>o.isBase))||{name:"N/A",factor:1},a=u.productType==="Service"?1/0:u.openingQuantity||0,n=u.costingPrice||0,v=u.productType==="Service"?1/0:a*n;return{...u,avgCost:n,qty:a,value:v,avgCostFormatted:n.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),qtyFormatted:u.productType==="Service"?"N/A":`${a.toLocaleString("en-US")} ${g.name}`,valueFormatted:u.productType==="Service"?"N/A":v.toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}),baseUnitName:g.name}},C=({children:u,columnKey:g,sortConfig:a,requestSort:n,isTextRight:v=!1,className:s=""})=>{const o=a&&a.key===g,F=o?a.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${v?"text-right":"text-left"} ${s}`,onClick:()=>n(g),children:e.jsxs("div",{className:`flex items-center ${v?"justify-end":"justify-start"}`,children:[!v&&u,e.jsx("span",{className:`mx-1 ${v?"mr-0 ml-1":"ml-0 mr-1"}`,children:o?F==="ascending"?"▲":"▼":e.jsx(ct,{size:14,className:"opacity-40"})}),v&&u]})})},Dt=()=>{const{toast:u}=Ce(),[g,a]=d.useState(()=>Se.map(Y)),[n,v]=d.useState(""),[s,o]=d.useState({key:"sl",direction:"ascending"}),[F,S]=d.useState(!1),[w,Q]=d.useState(null),[z,P]=d.useState(!1),[k,U]=d.useState(null);d.useEffect(()=>{const r=localStorage.getItem("products");r?a(JSON.parse(r).map(Y)):localStorage.setItem("products",JSON.stringify(Se))},[]);const I=r=>{localStorage.setItem("products",JSON.stringify(r.map(({avgCostFormatted:x,qtyFormatted:y,valueFormatted:m,baseUnitName:p,...A})=>A)))},T=(r=null)=>{Q(r),S(!0)},E=()=>{S(!1),Q(null)},O=(r,x)=>{a(y=>{let m;if(x)m=y.map(p=>p.id===r.id?Y({...p,...r}):p);else{const p=y.length>0?Math.max(...y.map(L=>L.sl))+1:1,A=Y({...r,sl:p});m=[...y,A]}return I(m),m})},W=r=>{const x=g.find(y=>y.id===r);x&&(U(x),P(!0))},B=()=>{if(k){const r=g.filter(x=>x.id!==k.id);a(r),I(r),u({title:"Product Deleted",description:`${k.name} has been deleted.`,variant:"destructive"}),P(!1),U(null)}},q=()=>{u({title:"Import Products from Excel",description:"This feature will be available soon.",duration:3e3})},$=r=>v(r.target.value),f=r=>{let x="ascending";s&&s.key===r&&s.direction==="ascending"&&(x="descending"),o({key:r,direction:x})},D=d.useMemo(()=>{let r=[...g];if(n){const x=n.toLowerCase();r=r.filter(y=>Object.values(y).some(m=>String(m).toLowerCase().includes(x)))}return s!==null&&r.sort((x,y)=>{let m=x[s.key],p=y[s.key];return["avgCost","qty","value","sl","costingPrice","openingQuantity","salesPrice"].includes(s.key)?(m=m===1/0?s.direction==="ascending"?1/0:-1/0:parseFloat(m)||0,p=p===1/0?s.direction==="ascending"?1/0:-1/0:parseFloat(p)||0):typeof m=="string"&&(m=m.toLowerCase(),p=p.toLowerCase()),m<p?s.direction==="ascending"?-1:1:m>p?s.direction==="ascending"?1:-1:0}),r},[n,s,g]);return e.jsx("div",{className:"space-y-6 p-1",children:e.jsxs(rt,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(at,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(st,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(me,{size:28,className:"mr-3 text-yellow-500 dark:text-yellow-400"})," Products & Services"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(Oe,{children:[e.jsx(We,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(ce,{size:20,className:"mr-2"})," Add New"]})}),e.jsxs(qe,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(ye,{onClick:()=>T(null),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Create Product/Service"}),e.jsxs(ye,{onClick:q,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:[e.jsx(dt,{size:16,className:"mr-2"})," Import from Excel"]})]})]})})]})}),e.jsxs(ot,{className:"p-4 md:p-6",children:[e.jsx(Ke,{open:F,onOpenChange:S,children:e.jsxs(Re,{className:"sm:max-w-2xl bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(Fe,{children:[e.jsx(we,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:w?"Edit Product/Service":"Add New Product/Service"}),e.jsxs(Pe,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:["Fill in the details below. Fields marked with ",e.jsx("span",{className:"text-destructive dark:text-red-400",children:"*"})," are required."]})]}),e.jsx(lt,{onSave:O,onCancel:E,initialData:w,isEditMode:!!w,allProducts:g})]})}),e.jsx(He,{open:z,onOpenChange:P,children:e.jsxs(Je,{children:[e.jsxs(Ge,{children:[e.jsx(Ye,{children:"Are you absolutely sure?"}),e.jsxs(Me,{children:['This action cannot be undone. This will permanently delete the product/service "',k==null?void 0:k.name,'".']})]}),e.jsxs(Xe,{children:[e.jsx(Ze,{onClick:()=>P(!1),children:"Cancel"}),e.jsx(_e,{onClick:B,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete product/service"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(l,{type:"text",placeholder:"Search products/services (ID, Name, Base Unit...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:n,onChange:$}),e.jsxs(N,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>u({title:"Search Updated",description:`Displaying results for "${n}"`}),children:[e.jsx(nt,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[800px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(C,{columnKey:"sl",sortConfig:s,requestSort:f,className:"w-16",children:"Sl"}),e.jsx(C,{columnKey:"id",sortConfig:s,requestSort:f,children:"ID"}),e.jsx(C,{columnKey:"name",sortConfig:s,requestSort:f,className:"min-w-[200px]",children:"Product Name"}),e.jsx(C,{columnKey:"productType",sortConfig:s,requestSort:f,children:"Type"}),e.jsx(C,{columnKey:"baseUnitName",sortConfig:s,requestSort:f,children:"Base Unit"}),e.jsx(C,{columnKey:"avgCost",sortConfig:s,requestSort:f,isTextRight:!0,children:"Avg. Cost"}),e.jsx(C,{columnKey:"qty",sortConfig:s,requestSort:f,isTextRight:!0,children:"Quantity"}),e.jsx(C,{columnKey:"value",sortConfig:s,requestSort:f,isTextRight:!0,children:"Value"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[D.map(r=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3",children:r.sl}),e.jsx("td",{className:"px-4 py-3 text-xs font-mono",children:r.id}),e.jsx("td",{className:"px-4 py-3",children:r.name}),e.jsx("td",{className:"px-4 py-3",children:r.productType}),e.jsx("td",{className:"px-4 py-3",children:r.baseUnitName}),e.jsx("td",{className:"px-4 py-3 text-right",children:r.avgCostFormatted}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold hover:underline cursor-pointer text-primary dark:text-dark-primary",onClick:()=>u({title:`Product Ledger: ${r.name}`,description:"Detailed product ledger view coming soon."}),children:r.qtyFormatted}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:r.valueFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(N,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>T(r),children:e.jsx(it,{size:16})}),e.jsx(N,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>W(r.id),children:e.jsx(le,{size:16})})]})]},r.id||r.sl)),D.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:n?`No products or services found for "${n}".`:"No products or services found. Add some to get started!"})})]})]})})]})]})})};export{Dt as default};
