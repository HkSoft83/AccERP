import{u as J,r as o,j as e,B as k}from"./index-712dd123.js";import{I as x}from"./input-0e3bd006.js";import{D as V,a as G,b as Z,c as Q,d as W,e as X,f as _,g as M,h as U,i as R,j as ee,A as re,k as ae,l as te,m as se,n as oe,o as ne,p as de,q as le}from"./alert-dialog-7872d5c2.js";import{L as u}from"./label-b1f93db9.js";import{D as ce}from"./date-picker-c96add2e.js";import{S as q}from"./save-f7d3c425.js";import{C as ie,a as me,b as ue,c as xe}from"./card-f81b6c80.js";import{U as pe}from"./user-842ce559.js";import{P as he}from"./plus-circle-b5794bb7.js";import{S as ge}from"./search-66d65b07.js";import{P as be,A as je}from"./pen-square-12844aac.js";import{T as fe}from"./trash-2-2438c5fa.js";import"./check-c977fa3e.js";const Ne=({onSave:m,onCancel:p,initialData:s,isEditMode:t})=>{const{toast:h}=J(),[n,b]=o.useState(""),[C,f]=o.useState(""),[N,v]=o.useState(""),[I,j]=o.useState(""),[g,y]=o.useState(""),[w,S]=o.useState(""),[$,D]=o.useState(""),[T,B]=o.useState(""),[P,A]=o.useState(""),[O,F]=o.useState(""),[r,d]=o.useState(void 0),[i,l]=o.useState(null);o.useEffect(()=>{var a;t&&s?(b(s.name||""),f(s.proprietorName||""),v(s.customerNumber||""),j(s.phoneNumber||""),y(s.address||""),S(s.nid||""),D(s.extraField1||""),B(s.extraField2||""),A(s.extraField3||""),F(((a=s.openingBalance)==null?void 0:a.toString())||""),d(s.openingBalanceDate?new Date(s.openingBalanceDate):void 0),l(s.id||s.customerNumber)):c()},[s,t]);const c=()=>{b(""),f(""),v(""),j(""),y(""),S(""),D(""),B(""),A(""),F(""),d(void 0),l(null)},L=(a,K=!0)=>{if(a.preventDefault(),!n){h({title:"Validation Error",description:"Customer Name is required.",variant:"destructive"});return}const Y={id:i||`cust-${Date.now()}`,name:n,proprietorName:C,customerNumber:N||(i?i.split("-")[1]||String(Date.now()).slice(-4):`C${String(Date.now()).slice(-4)}`),phoneNumber:I,address:g,nid:w,extraField1:$,extraField2:T,extraField3:P,openingBalance:parseFloat(O)||0,openingBalanceDate:r?r.toISOString().split("T")[0]:null};m(Y,t),h({title:`Customer ${t?"Updated":"Saved"}!`,description:`${n} has been successfully ${t?"updated":"added"}.`}),K?p():t||c()};return e.jsxs("form",{onSubmit:a=>L(a,!0),className:"space-y-4 py-2",children:[e.jsxs(V,{className:"hidden",children:[e.jsx(G,{children:t?"Edit Customer":"Add New Customer"}),e.jsx(Z,{children:t?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsxs("div",{children:[e.jsxs(u,{htmlFor:"customerName",children:["Customer Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(x,{id:"customerName",value:n,onChange:a=>b(a.target.value),placeholder:"e.g., Client Omega Corp.",className:"mt-1",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"proprietorName",children:"Proprietor Name"}),e.jsx(x,{id:"proprietorName",value:C,onChange:a=>f(a.target.value),placeholder:"e.g., Jane Smith",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"customerNumber",children:"Customer Number"}),e.jsx(x,{id:"customerNumber",value:N,onChange:a=>v(a.target.value),placeholder:"e.g., C001",className:"mt-1",disabled:t}),t&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Customer number cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"phoneNumber",children:"Phone Number"}),e.jsx(x,{id:"phoneNumber",value:I,onChange:a=>j(a.target.value),placeholder:"e.g., +1234567890",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"address",children:"Address"}),e.jsx(x,{id:"address",value:g,onChange:a=>y(a.target.value),placeholder:"e.g., 456 Client Ave",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"nid",children:"NID"}),e.jsx(x,{id:"nid",value:w,onChange:a=>S(a.target.value),placeholder:"e.g., 1234567890",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"extraField1",children:"Extra Field 1"}),e.jsx(x,{id:"extraField1",value:$,onChange:a=>D(a.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"extraField2",children:"Extra Field 2"}),e.jsx(x,{id:"extraField2",value:T,onChange:a=>B(a.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"extraField3",children:"Extra Field 3"}),e.jsx(x,{id:"extraField3",value:P,onChange:a=>A(a.target.value),placeholder:"",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"openingBalance",children:"Opening Balance"}),e.jsx(x,{id:"openingBalance",type:"number",value:O,onChange:a=>F(a.target.value),placeholder:"0.00",className:"mt-1",disabled:t}),t&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance cannot be changed after creation."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"openingBalanceDate",children:"Opening Balance As of Date"}),e.jsx(ce,{date:r,setDate:d,className:"mt-1 w-full",disabled:t}),t&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Opening balance date cannot be changed after creation."})]}),e.jsxs(Q,{className:"pt-6",children:[e.jsx(W,{asChild:!0,children:e.jsx(k,{variant:"outline",onClick:p,children:"Cancel"})}),!t&&e.jsxs(k,{type:"button",onClick:a=>L(a,!1),variant:"secondary",children:[e.jsx(q,{size:18,className:"mr-2"})," Save & New"]}),e.jsxs(k,{type:"submit",children:[e.jsx(q,{size:18,className:"mr-2"})," ",t?"Update Customer":"Save & Close"]})]})]})},E=[{id:"cust-001",name:"Client Omega Corp.",proprietorName:"Mr. O",customerNumber:"C001",address:"123 Omega St",balance:2800,openingBalance:2800,openingBalanceDate:"2023-01-01"},{id:"cust-002",name:"Customer Zeta Ltd.",proprietorName:"Ms. Z",customerNumber:"C002",address:"456 Zeta Ave",balance:0,openingBalance:0,openingBalanceDate:"2023-01-01"},{id:"cust-003",name:"Patron Gamma Solutions",proprietorName:"Dr. G",customerNumber:"C003",address:"789 Gamma Rd",balance:5120.75,openingBalance:5120.75,openingBalanceDate:"2023-01-01"},{id:"cust-004",name:"Client Alpha Services",proprietorName:"Prof. A",customerNumber:"C004",address:"012 Alpha Blvd",balance:-300,openingBalance:-300,openingBalanceDate:"2023-01-01"}],z=m=>({...m,balanceFormatted:(m.balance||0).toLocaleString("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2})}),H=({children:m,columnKey:p,sortConfig:s,requestSort:t,isTextRight:h=!1,className:n=""})=>{const b=s&&s.key===p,C=b?s.direction:null;return e.jsx("th",{scope:"col",className:`px-4 py-3 cursor-pointer hover:bg-primary/10 dark:hover:bg-dark-primary/10 transition-colors ${h?"text-right":"text-left"} ${n}`,onClick:()=>t(p),children:e.jsxs("div",{className:`flex items-center ${h?"justify-end":"justify-start"}`,children:[!h&&m,e.jsx("span",{className:`mx-1 ${h?"mr-0 ml-1":"ml-0 mr-1"}`,children:b?C==="ascending"?"▲":"▼":e.jsx(je,{size:14,className:"opacity-40"})}),h&&m]})})},Te=()=>{const{toast:m}=J(),[p,s]=o.useState(()=>E.map(z)),[t,h]=o.useState(""),[n,b]=o.useState({key:"name",direction:"ascending"}),[C,f]=o.useState(!1),[N,v]=o.useState(null),[I,j]=o.useState(!1),[g,y]=o.useState(null);o.useEffect(()=>{const r=localStorage.getItem("customers");r?s(JSON.parse(r).map(z)):localStorage.setItem("customers",JSON.stringify(E))},[]);const w=r=>{localStorage.setItem("customers",JSON.stringify(r.map(({balanceFormatted:d,...i})=>i)))},S=(r=null)=>{v(r),f(!0)},$=()=>{f(!1),v(null)},D=(r,d)=>{s(i=>{let l;if(d)l=i.map(c=>c.id===r.id?z({...c,...r,balance:r.openingBalance}):c);else{const c=z({...r,balance:r.openingBalance});l=[...i,c]}return w(l),l})},T=r=>{const d=p.find(i=>i.id===r);d&&(y(d),j(!0))},B=()=>{if(g){const r=p.filter(d=>d.id!==g.id);s(r),w(r),m({title:"Customer Deleted",description:`${g.name} has been deleted.`,variant:"destructive"}),j(!1),y(null)}},P=()=>{m({title:"Import Customers from Excel",description:"This feature will be available soon.",duration:3e3})},A=r=>h(r.target.value),O=r=>{let d="ascending";n&&n.key===r&&n.direction==="ascending"&&(d="descending"),b({key:r,direction:d})},F=o.useMemo(()=>{let r=[...p];if(t){const d=t.toLowerCase();r=r.filter(i=>Object.values(i).some(l=>String(l).toLowerCase().includes(d)))}return n!==null&&r.sort((d,i)=>{let l=d[n.key],c=i[n.key];return n.key==="balance"?(l=parseFloat(l)||0,c=parseFloat(c)||0):typeof l=="string"&&(l=l.toLowerCase(),c=c.toLowerCase()),l<c?n.direction==="ascending"?-1:1:l>c?n.direction==="ascending"?1:-1:0}),r},[t,n,p]);return e.jsx("div",{className:"space-y-6 p-1",children:e.jsxs(ie,{className:"shadow-lg border-border dark:border-dark-border",children:[e.jsx(me,{className:"bg-card dark:bg-dark-card rounded-t-lg p-4 md:p-6 border-b border-border dark:border-dark-border",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-3",children:[e.jsxs(ue,{className:"text-2xl md:text-3xl font-bold text-primary dark:text-dark-primary flex items-center",children:[e.jsx(pe,{size:28,className:"mr-3 text-accent dark:text-dark-accent"})," Customer Center"]}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(X,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(k,{variant:"outline",className:"text-primary dark:text-dark-primary border-primary dark:border-dark-primary hover:bg-primary/10 dark:hover:bg-dark-primary/10 shadow-sm",children:[e.jsx(he,{size:20,className:"mr-2"})," Add Customer"]})}),e.jsxs(M,{align:"end",className:"bg-card dark:bg-dark-card shadow-lg rounded-md border border-border dark:border-dark-border",children:[e.jsx(U,{onClick:()=>S(null),className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Add New"}),e.jsx(U,{onClick:P,className:"text-foreground dark:text-dark-foreground hover:bg-primary/10 dark:hover:bg-dark-primary/10 cursor-pointer",children:"Import from Excel"})]})]})})]})}),e.jsxs(xe,{className:"p-4 md:p-6",children:[e.jsx(R,{open:C,onOpenChange:f,children:e.jsxs(ee,{className:"sm:max-w-[550px] bg-card dark:bg-dark-card text-foreground dark:text-dark-foreground border-border dark:border-dark-border shadow-2xl rounded-lg",children:[e.jsxs(V,{children:[e.jsx(G,{className:"text-primary dark:text-dark-primary text-2xl font-semibold",children:N?"Edit Customer":"Add New Customer"}),e.jsx(Z,{className:"text-muted-foreground dark:text-dark-muted-foreground",children:N?"Update customer details.":"Fill in the details to add a new customer."})]}),e.jsx(Ne,{onSave:D,onCancel:$,initialData:N,isEditMode:!!N})]})}),e.jsx(re,{open:I,onOpenChange:j,children:e.jsxs(ae,{children:[e.jsxs(te,{children:[e.jsx(se,{children:"Are you absolutely sure?"}),e.jsxs(oe,{children:['This action cannot be undone. This will permanently delete the customer "',g==null?void 0:g.name,'".']})]}),e.jsxs(ne,{children:[e.jsx(de,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(le,{onClick:B,className:"bg-destructive hover:bg-destructive/90",children:"Yes, delete customer"})]})]})}),e.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-background dark:bg-dark-background rounded-lg shadow-sm border border-border dark:border-dark-border",children:[e.jsx(x,{type:"text",placeholder:"Search customers (Name, Balance...)",className:"flex-grow focus:ring-accent dark:focus:ring-dark-accent border-input dark:border-dark-input focus:border-primary dark:focus:border-dark-primary",value:t,onChange:A}),e.jsxs(k,{className:"bg-primary text-primary-foreground hover:bg-primary-hover dark:bg-dark-primary dark:text-dark-primary-foreground dark:hover:bg-dark-primary-hover",onClick:()=>m({title:"Search Updated",description:`Displaying results for "${t}"`}),children:[e.jsx(ge,{size:18,className:"mr-2"})," Search"]})]}),e.jsx("div",{className:"overflow-x-auto rounded-lg border border-border dark:border-dark-border shadow-md",children:e.jsxs("table",{className:"w-full min-w-[600px] text-sm text-left text-foreground dark:text-dark-foreground",children:[e.jsx("thead",{className:"text-xs text-primary dark:text-dark-primary uppercase bg-muted/50 dark:bg-dark-muted/50",children:e.jsxs("tr",{children:[e.jsx(H,{columnKey:"name",sortConfig:n,requestSort:O,className:"min-w-[250px]",children:"Customer Name"}),e.jsx(H,{columnKey:"balance",sortConfig:n,requestSort:O,isTextRight:!0,children:"Balance"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center w-28",children:"Actions"})]})}),e.jsxs("tbody",{children:[F.map(r=>e.jsxs("tr",{className:"bg-card dark:bg-dark-card border-b border-border dark:border-dark-border last:border-b-0 hover:bg-muted/30 dark:hover:bg-dark-muted/30 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-secondary dark:text-dark-secondary hover:underline cursor-pointer",onClick:()=>m({title:`View Ledger: ${r.name}`,description:"Detailed customer ledger view coming soon."}),children:r.name}),e.jsx("td",{className:"px-4 py-3 text-right font-semibold",children:r.balanceFormatted}),e.jsxs("td",{className:"px-4 py-3 text-center space-x-1",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"text-secondary dark:text-dark-secondary hover:text-accent dark:hover:text-dark-accent h-8 w-8",onClick:()=>S(r),children:e.jsx(be,{size:16})}),e.jsx(k,{variant:"ghost",size:"icon",className:"text-destructive dark:text-red-400 hover:text-destructive/80 dark:hover:text-red-300 h-8 w-8",onClick:()=>T(r.id),children:e.jsx(fe,{size:16})})]})]},r.id)),F.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"text-center py-10 text-muted-foreground dark:text-dark-muted-foreground",children:t?`No customers found for "${t}".`:"No customers found. Start by adding a customer!"})})]})]})})]})]})})};export{Te as default};
