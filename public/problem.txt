account sub type is not prefiiled when edit mode, others field are okay. see the suggestion


ChatGPT said:
Thanks for confirming. Since all fields except accountSubtype are being prefilled correctly in edit mode, and your console shows:


AddAccountForm.jsx:43 AddAccountForm useEffect - initialData: Object
...
AddAccountForm.jsx:120 Rendering AddAccountForm with: { accountType: 'Expense', accountSubtype: '', ... }
That means something resets accountSubtype to an empty string after useEffect sets it.

âœ… Root Cause (Confirmed)
In your useEffect, you set:


setAccountSubtype(initialData.isHeader ? '' : (initialData.accSubtype || ''));
Then in this block:


<Select
  onValueChange={(value) => {
    if (value !== accountType) {
      setAccountType(value);
      setAccountSubtype('');
    }
  }}
  value={accountType}
  required
>
Even in edit mode, this logic clears accountSubtype if accountType changes â€” which it might even from '' to 'Expense', triggering a reset.

âœ… Fix Strategy
We want accountSubtype to not be cleared on first load in edit mode, but still cleared when the user manually changes accountType.

âœ… Final Fix: Add an initialLoadComplete flag
Here's a clean and bulletproof way to do it:

ðŸ”§ Step 1: Add a ref to detect first render
At the top of AddAccountForm:


const initialRender = React.useRef(true);
ðŸ”§ Step 2: Update your accountType <Select> logic:

<Select
  onValueChange={(value) => {
    if (value !== accountType) {
      setAccountType(value);
      if (!initialRender.current) {
        setAccountSubtype('');
      }
    }
  }}
  value={accountType}
  required
>
ðŸ”§ Step 3: In useEffect, after setting all fields, mark initial load complete
At the very bottom of your useEffect:


initialRender.current = false;
âœ… Why this works:
On first load (initialRender.current === true), we skip resetting accountSubtype

On user interaction, initialRender.current is already false, so accountSubtype clears as expected

ðŸ§ª Optional Debug Console:
Add this inside onValueChange to verify:


console.log("accountType changed:", value, "Initial Render?", initialRender.current);
Let me know if youâ€™d like this implemented as a full snippet or want help persisting data to storage or backend next.